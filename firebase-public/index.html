<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="no-referrer" />
  <title>KimGetirdi — Influencer Yönetimi</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-primary: #f8fafc;
      --bg-secondary: #f1f5f9;
      --bg-card: #ffffff;
      --bg-hover: #e2e8f0;
      --border: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --accent: #6366f1;
      --accent-hover: #4f46e5;
      --accent-soft: rgba(99, 102, 241, 0.12);
      --success: #22c55e;
      --danger: #ef4444;
      --radius: 12px;
      --radius-lg: 16px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
    }
    html[data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #1e293b;
      --bg-hover: #334155;
      --border: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --accent: #818cf8;
      --accent-hover: #a5b4fc;
      --accent-soft: rgba(129, 140, 248, 0.2);
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
    }
    html[data-theme="dark"] .hero h1 {
      background: linear-gradient(180deg, #f1f5f9 0%, #94a3b8 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }
    html[data-theme="dark"] .dashboard-welcome { color: var(--text-primary); }
    html[data-theme="dark"] .dashboard-subtitle { color: var(--text-muted); }
    html[data-theme="dark"] .dashboard-card {
      background: var(--bg-card);
      border-color: var(--border);
    }
    html[data-theme="dark"] .dashboard-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
    html[data-theme="dark"] .dashboard-card-arrow {
      background: rgba(255, 255, 255, 0.08);
    }
    html[data-theme="dark"] .dashboard-card:hover .dashboard-card-arrow {
      background: rgba(255, 255, 255, 0.12);
    }
    html[data-theme="dark"] .admin-splash-bg { background: #0f172a; }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    .app {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 1.5rem 0;
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Tema ve Çıkış yap sadece üst barda; sidebar/drawer'da hiç gösterilmez */
    .sidebar .theme-toggle-sidebar,
    .sidebar .nav-item--logout {
      display: none !important;
    }

    .logo {
      padding: 0 1.5rem 1.5rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1rem;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .logo:hover {
      opacity: 0.9;
    }

    .logo h1 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .logo span {
      color: var(--accent);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      margin: 0 0.75rem;
      border-radius: var(--radius);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 600;
      transition: color 0.25s, background 0.25s, box-shadow 0.25s, transform 0.2s;
      border: 1px solid transparent;
    }

    .nav-item:hover {
      transform: translateX(2px);
    }

    .nav-item-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 10px;
      flex-shrink: 0;
      transition: background 0.25s, color 0.25s;
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
    }

    /* Influencer'lar — mor/indigo gradient */
    .nav-item--influencers .nav-item-icon {
      background: rgba(99, 102, 241, 0.15);
      color: #6366f1;
    }
    .nav-item--influencers:hover,
    .nav-item--influencers.active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      color: #fff;
      border-color: rgba(139, 92, 246, 0.4);
      box-shadow: 0 4px 14px rgba(99, 102, 241, 0.35);
    }
    .nav-item--influencers:hover .nav-item-icon,
    .nav-item--influencers.active .nav-item-icon {
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
    }

    /* Değerlendirmeler — amber/turuncu gradient */
    .nav-item--reviews .nav-item-icon {
      background: rgba(245, 158, 11, 0.15);
      color: #d97706;
    }
    .nav-item--reviews:hover,
    .nav-item--reviews.active {
      background: linear-gradient(135deg, #f59e0b 0%, #ea580c 50%, #dc2626 100%);
      color: #fff;
      border-color: rgba(234, 88, 12, 0.4);
      box-shadow: 0 4px 14px rgba(245, 158, 11, 0.35);
    }
    .nav-item--reviews:hover .nav-item-icon,
    .nav-item--reviews.active .nav-item-icon {
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
    }

    /* Raporlar — kırmızı/pembe gradient */
    .nav-item--reports .nav-item-icon {
      background: rgba(225, 29, 72, 0.15);
      color: #e11d48;
    }
    .nav-item--reports:hover,
    .nav-item--reports.active {
      background: linear-gradient(135deg, #e11d48 0%, #dc2626 50%, #b91c1c 100%);
      color: #fff;
      border-color: rgba(220, 38, 38, 0.4);
      box-shadow: 0 4px 14px rgba(225, 29, 72, 0.35);
    }
    .nav-item--reports:hover .nav-item-icon,
    .nav-item--reports.active .nav-item-icon {
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
    }

    /* Mesajlar — mavi/indigo */
    .nav-item--messages .nav-item-icon {
      background: rgba(79, 70, 229, 0.15);
      color: #4f46e5;
    }
    .nav-item--messages:hover,
    .nav-item--messages.active {
      background: linear-gradient(135deg, #4f46e5 0%, #6366f1 50%, #818cf8 100%);
      color: #fff;
      border-color: rgba(99, 102, 241, 0.4);
      box-shadow: 0 4px 14px rgba(79, 70, 229, 0.35);
    }
    .nav-item--messages:hover .nav-item-icon,
    .nav-item--messages.active .nav-item-icon {
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
    }

    /* Çıkış yap — kırmızı */
    .nav-item--logout,
    .nav-item--logout .nav-item-text {
      color: var(--danger);
    }
    .nav-item--logout .nav-item-icon {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }
    .nav-item--logout:hover {
      background: rgba(239, 68, 68, 0.12);
      color: #dc2626;
      border-color: rgba(239, 68, 68, 0.35);
    }
    .nav-item--logout:hover .nav-item-icon {
      background: rgba(239, 68, 68, 0.25);
      color: #dc2626;
    }

    .sidebar-btn-add {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin: 0 1.5rem;
      padding: 0.75rem 1rem;
      font-size: 0.9375rem;
      font-weight: 600;
      font-family: inherit;
      color: #fff;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
      background-size: 200% 200%;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .sidebar-btn-add:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
    }

    .sidebar-btn-add:active {
      transform: translateY(0);
    }

    .sidebar-btn-add svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .sidebar-btn-add {
      margin-bottom: 0.5rem;
    }

    .sidebar-list-title {
      font-family: 'Outfit', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      padding: 0 1.5rem;
      margin: 1rem 0 0.5rem;
      flex-shrink: 0;
    }

    .sidebar-list-title.top {
      margin: 0.5rem 0 0.5rem;
    }

    .sidebar-influencers {
      flex: 1;
      overflow-y: auto;
      padding: 0 0 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .sidebar-influencer {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      transition: border-color 0.2s, background 0.2s;
      min-height: 48px;
    }

    .sidebar-influencer:hover {
      border-color: var(--accent);
      background: var(--bg-hover);
    }

    .sidebar-influencer.selected {
      border-color: var(--accent);
      background: var(--accent-soft);
    }

    .sidebar-influencer {
      cursor: pointer;
    }

    .sidebar-influencer-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--bg-secondary);
      flex-shrink: 0;
    }

    .sidebar-influencer-text {
      min-width: 0;
      flex: 1;
    }

    .sidebar-influencer-name {
      font-size: 0.9375rem;
      font-weight: 500;
      word-break: break-word;
    }

    .sidebar-influencer-username {
      font-size: 0.75rem;
      color: var(--text-muted);
      word-break: break-word;
    }

    .sidebar-empty {
      padding: 1rem;
      font-size: 0.8125rem;
      color: var(--text-muted);
      text-align: center;
    }

    /* Main */
    .main {
      padding: 2rem 2.5rem 3rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .page-header {
      margin-bottom: 2rem;
    }

    .page-header h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.25rem;
    }

    .page-header p {
      color: var(--text-secondary);
      font-size: 0.9375rem;
    }

    /* Form card */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.75rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
    }

    .card-title {
      font-family: 'Outfit', sans-serif;
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.full {
      grid-column: 1 / -1;
    }

    .form-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin: 0.25rem 0 0;
    }

    .file-upload-wrap {
      position: relative;
      margin-top: 0.5rem;
    }

    .file-upload-input {
      position: absolute;
      width: 0.1px;
      height: 0.1px;
      opacity: 0;
      overflow: hidden;
      z-index: -1;
    }

    .file-upload-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.625rem 1.25rem;
      background: var(--bg-card);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s, color 0.2s;
    }

    .file-upload-btn:hover {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .file-upload-btn:focus-within {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .file-upload-icon {
      display: inline-flex;
      width: 1.25rem;
      height: 1.25rem;
      color: inherit;
    }

    .file-upload-btn .file-upload-icon svg {
      width: 100%;
      height: 100%;
    }

    .form-file-name {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: block;
      margin-top: 0.5rem;
    }

    .form-file-name.has-file {
      color: var(--accent);
      font-weight: 500;
    }

    label {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    input[type="text"],
    input[type="url"] {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-size: 0.9375rem;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    input::placeholder {
      color: var(--text-muted);
    }

    /* Reels list */
    .reels-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .reel-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .reel-row input {
      flex: 1;
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .btn-icon:hover {
      background: var(--bg-hover);
      color: var(--danger);
      border-color: var(--danger);
    }

    .btn-add-reel {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--accent);
      background: var(--accent-soft);
      border: 1px dashed var(--accent);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.5rem;
    }

    .btn-add-reel:hover {
      background: rgba(99, 102, 241, 0.25);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      font-family: inherit;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }

    .btn-ghost:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .btn-danger {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
      background: var(--danger);
      color: white;
    }

    .form-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    /* Influencer list */
    .influencers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.25rem;
    }

    .influencer-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .influencer-card:hover {
      border-color: var(--accent);
      box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12);
    }

    .influencer-thumb {
      aspect-ratio: 16/10;
      background: var(--bg-secondary);
      object-fit: cover;
      width: 100%;
    }

    .influencer-body {
      padding: 1.25rem;
    }

    .influencer-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .influencer-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--bg-secondary);
    }

    .influencer-name {
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      font-size: 1rem;
    }

    .influencer-username {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-top: 0.125rem;
    }

    .influencer-username a {
      color: var(--accent);
      text-decoration: none;
    }

    .influencer-username a:hover {
      text-decoration: underline;
    }

    .influencer-meta {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .influencer-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .influencer-actions .btn {
      padding: 0.5rem 0.75rem;
      font-size: 0.8125rem;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      background: var(--bg-card);
      border: 1px dashed var(--border);
      border-radius: var(--radius-lg);
      color: var(--text-muted);
    }

    .empty-state svg {
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .toast {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      padding: 0.875rem 1.25rem;
      border-radius: var(--radius);
      font-size: 0.9375rem;
      font-weight: 500;
      box-shadow: var(--shadow);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      background: var(--success);
      color: white;
    }

    .toast.error {
      background: var(--danger);
      color: white;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .loading {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(99, 102, 241, 0.25);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .section-title {
      font-family: 'Outfit', sans-serif;
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      margin-top: 2rem;
    }

    .detail-panel {
      margin-top: 1.5rem;
      overflow: hidden;
      padding: 0;
    }

    .detail-panel-hero {
      position: relative;
      width: 100%;
      min-height: 220px;
      display: flex;
      align-items: flex-end;
    }

    .detail-panel-hero-bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .detail-panel-hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(15, 23, 42, 0.92) 0%, rgba(15, 23, 42, 0.4) 45%, transparent 70%);
    }

    .detail-panel-hero-content {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem 1.5rem 1.25rem;
      width: 100%;
    }

    .detail-panel-avatar {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--bg-secondary);
      border: 3px solid rgba(255, 255, 255, 0.2);
      flex-shrink: 0;
    }

    .detail-panel-name {
      font-family: 'Outfit', 'DM Sans', sans-serif;
      font-size: 1.375rem;
      font-weight: 600;
      color: #fff;
      margin: 0 0 0.2rem 0;
      letter-spacing: -0.02em;
    }

    .detail-panel-username {
      font-size: 0.9375rem;
      color: rgba(255, 255, 255, 0.85);
    }

    .detail-panel-username a {
      color: rgba(255, 255, 255, 0.95);
      text-decoration: none;
      font-weight: 500;
    }

    .detail-panel-username a:hover {
      text-decoration: underline;
    }

    .detail-panel-media {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      padding: 1rem 1.5rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    .detail-panel-media-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.35rem;
    }

    .detail-panel-media-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
    }

    .detail-panel-media-thumb {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 10px;
      background: var(--bg-card);
    }

    .detail-panel-media-link {
      margin-left: auto;
    }

    .detail-panel-media-value {
      font-size: 0.8125rem;
      max-width: 180px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .detail-panel-media-value a {
      color: var(--accent);
      text-decoration: none;
    }

    .detail-panel-media-value a:hover {
      text-decoration: underline;
    }

    .detail-panel-body {
      padding: 1.25rem 1.5rem;
    }

    .detail-field {
      margin-bottom: 0;
    }

    .detail-field-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .detail-field-value {
      font-size: 0.9375rem;
      color: var(--text-primary);
      word-break: break-all;
    }

    .detail-reels-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .detail-reels-list li {
      margin-bottom: 0.4rem;
      font-size: 0.8125rem;
    }

    .detail-reels-list a {
      color: var(--accent);
      text-decoration: none;
      word-break: break-all;
    }

    .detail-reels-list a:hover {
      text-decoration: underline;
    }

    .detail-panel-actions {
      display: flex;
      gap: 0.75rem;
      padding: 1rem 1.5rem 1.25rem;
      border-top: 1px solid var(--border);
    }

    .crop-modal {
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }

    .crop-modal.is-open {
      opacity: 1;
      visibility: visible;
    }

    .crop-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
    }

    .crop-modal-box {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.25);
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .crop-modal-header {
      padding: 1.25rem 1.5rem 0 1.5rem;
    }

    .crop-modal-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0 0 0.25rem 0;
    }

    .crop-modal-desc {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin: 0 0 1rem 0;
    }

    .crop-modal-body {
      padding: 0 1.5rem;
      overflow: auto;
    }

    .crop-view {
      position: relative;
      display: inline-block;
      max-width: 100%;
      background: #1a1a1a;
      border-radius: var(--radius);
      overflow: hidden;
    }

    .crop-view canvas {
      display: block;
      max-width: 100%;
      height: auto;
    }

    .crop-frame {
      position: absolute;
      box-sizing: border-box;
      border: 2px solid #fff;
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
      cursor: move;
      touch-action: none;
    }

    .crop-frame::after {
      content: '';
      position: absolute;
      inset: 0;
      outline: 1px dashed rgba(255, 255, 255, 0.5);
      outline-offset: -4px;
      pointer-events: none;
    }

    .crop-modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      padding: 1rem 1.5rem 1.25rem;
    }

    /* Hero */
    .main-content {
      display: flex;
      flex-direction: column;
      min-height: 100%;
    }

    .hero {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 3rem 0 4rem;
      max-width: 640px;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.875rem;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.8125rem;
      font-weight: 600;
      border-radius: 999px;
      margin-bottom: 1.5rem;
      width: fit-content;
    }

    .hero h1 {
      font-family: 'Outfit', sans-serif;
      font-size: clamp(2.25rem, 5vw, 3.25rem);
      font-weight: 700;
      line-height: 1.15;
      letter-spacing: -0.03em;
      margin-bottom: 1rem;
      background: linear-gradient(180deg, #0f172a 0%, #475569 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero h1 span {
      background: linear-gradient(135deg, #6366f1 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-desc {
      font-size: 1.125rem;
      color: var(--text-secondary);
      line-height: 1.65;
      margin-bottom: 2rem;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .btn-hero {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.875rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      font-family: inherit;
      border-radius: var(--radius);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: none;
      text-decoration: none;
    }

    .btn-hero-primary {
      background: #4f46e5;
      color: #fff;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .btn-hero-primary:hover {
      background: #4338ca;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
    }

    .btn-hero-ghost {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-hero-ghost:hover {
      background: var(--bg-hover);
      border-color: var(--accent);
    }

    .hero-stats {
      display: flex;
      gap: 2.5rem;
      margin-top: 3rem;
      padding-top: 2.5rem;
      border-top: 1px solid var(--border);
    }

    .hero-stat {
      font-family: 'Outfit', sans-serif;
    }

    .hero-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .hero-stat-label {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    #heroSection.hero {
      justify-content: flex-start;
      padding-top: 1.25rem;
      padding-bottom: 2rem;
      max-width: 100%;
    }
    .dashboard-wrap {
      width: 100%;
      max-width: 1000px;
      padding: 0 1rem;
    }
    .dashboard-header {
      margin-top: 0;
      margin-bottom: 1.75rem;
      padding: 0;
    }
    .dashboard-badge {
      display: inline-block;
      font-size: 0.625rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.35rem;
    }
    .dashboard-welcome {
      font-family: 'Outfit', sans-serif;
      font-size: clamp(1.375rem, 3.5vw, 1.75rem);
      font-weight: 600;
      letter-spacing: -0.03em;
      line-height: 1.25;
      color: var(--text-primary);
      margin: 0;
    }
    .dashboard-subtitle {
      font-size: 0.8125rem;
      color: var(--text-muted);
      line-height: 1.5;
      margin-top: 0.25rem;
      max-width: 36ch;
    }
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.25rem;
      margin-bottom: 2rem;
    }
    @media (max-width: 900px) {
      .dashboard-cards { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 480px) {
      .dashboard-cards { grid-template-columns: 1fr; }
    }
    .dashboard-card {
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0;
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 0;
      min-height: 88px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      overflow: hidden;
      position: relative;
    }
    .dashboard-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }
    .dashboard-card-accent {
      width: 20px;
      flex-shrink: 0;
      border-radius: 12px 0 0 12px;
    }
    .dashboard-card--influencers .dashboard-card-accent {
      background: linear-gradient(180deg, #10b981 0%, #059669 50%, #047857 100%);
    }
    .dashboard-card--reports .dashboard-card-accent {
      background: linear-gradient(180deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
    }
    .dashboard-card--reviews .dashboard-card-accent {
      background: linear-gradient(180deg, #eab308 0%, #ca8a04 50%, #a16207 100%);
    }
    .dashboard-card--messages .dashboard-card-accent {
      background: linear-gradient(180deg, #64748b 0%, #475569 50%, #334155 100%);
    }
    .dashboard-card-inner {
      flex: 1;
      padding: 0.875rem 1rem 0.875rem 1.125rem;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.75rem;
      min-width: 0;
    }
    .dashboard-card--clickable {
      cursor: pointer;
      text-align: left;
      width: 100%;
      font: inherit;
      color: inherit;
    }
    .dashboard-card-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .dashboard-card--influencers .dashboard-card-icon {
      background: rgba(16, 185, 129, 0.12);
      color: #059669;
    }
    .dashboard-card--reports .dashboard-card-icon {
      background: rgba(239, 68, 68, 0.12);
      color: #dc2626;
    }
    .dashboard-card--reviews .dashboard-card-icon {
      background: rgba(234, 179, 8, 0.18);
      color: #ca8a04;
    }
    .dashboard-card--messages .dashboard-card-icon {
      background: rgba(100, 116, 139, 0.18);
      color: #475569;
    }
    .dashboard-card-icon svg {
      width: 16px;
      height: 16px;
    }
    .dashboard-card-body {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .dashboard-card-inner > .dashboard-card-arrow {
      margin-left: auto;
    }
    .dashboard-card-value {
      font-family: 'Outfit', sans-serif;
      font-size: 1.375rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text-primary);
      line-height: 1.2;
    }
    .dashboard-card-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-top: 0;
      letter-spacing: 0.01em;
    }
    .dashboard-card-arrow {
      flex-shrink: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      transition: color 0.2s, transform 0.2s;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.04);
    }
    .dashboard-card-arrow svg {
      width: 20px;
      height: 20px;
    }
    .dashboard-card:hover .dashboard-card-arrow {
      color: var(--text-primary);
      background: rgba(0, 0, 0, 0.06);
      transform: translateX(3px);
    }
    .dashboard-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .btn-hero--large {
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      border-radius: 14px;
      box-shadow: 0 4px 14px rgba(79, 70, 229, 0.25);
    }
    .btn-hero--large:hover {
      box-shadow: 0 8px 24px rgba(79, 70, 229, 0.35);
    }
    .btn-hero--large svg {
      width: 22px;
      height: 22px;
    }

    .form-section,
    .detail-section {
      display: none;
    }

    .form-section.visible,
    .detail-section.visible {
      display: block;
    }

    #detailPanel {
      display: none;
    }

    .detail-section.visible #detailPanel {
      display: block;
    }

    .hero.visible {
      display: flex;
    }

    .hero:not(.visible) {
      display: none;
    }

    /* List / Grid section */
    .list-section {
      display: none;
    }

    .list-section.visible,
    .reports-section.visible,
    .reviews-section.visible,
    .messages-section.visible {
      display: block;
    }

    .reports-section,
    .reviews-section,
    .messages-section {
      display: none;
    }

    .reports-section .page-header {
      margin-bottom: 1.5rem;
    }

    .report-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      margin-bottom: 1rem;
    }

    .report-card.resolved {
      opacity: 0.75;
      border-color: var(--text-muted);
    }

    .report-card-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem 1rem;
      margin-bottom: 0.75rem;
    }

    .report-card-influencer {
      font-weight: 600;
      color: var(--text-primary);
    }

    .report-card-date {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .report-card-summary {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .report-card-reason {
      font-size: 0.875rem;
      color: var(--accent);
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .report-card-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      white-space: pre-wrap;
    }

    .report-card-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .report-card-actions .btn {
      font-size: 0.875rem;
      padding: 0.5rem 0.75rem;
    }

    .messages-section .page-header {
      margin-bottom: 1.5rem;
    }

    .message-row {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      margin-bottom: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
    }

    .message-row:hover {
      background: var(--bg-hover);
      border-color: var(--accent);
    }

    .message-row-sender {
      font-weight: 600;
      color: var(--text-primary);
    }

    .message-row-subject {
      color: var(--text-secondary);
      font-size: 0.9375rem;
    }

    .message-row-arrow {
      color: var(--text-muted);
      flex-shrink: 0;
    }

    .message-detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .message-detail-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .message-detail-modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      max-width: 520px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }

    .message-detail-overlay.visible .message-detail-modal {
      transform: scale(1);
    }

    .message-detail-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .message-detail-modal-header h3 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .message-detail-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      line-height: 1;
      color: var(--text-muted);
      cursor: pointer;
      padding: 0.25rem;
      border-radius: var(--radius);
    }

    .message-detail-close:hover {
      color: var(--text-primary);
      background: var(--bg-hover);
    }

    .message-detail-body {
      padding: 1.5rem;
    }

    .message-detail-body p,
    .message-detail-body .message-detail-text-wrap {
      margin-bottom: 1rem;
      font-size: 0.9375rem;
      color: var(--text-secondary);
    }

    .message-detail-body strong {
      color: var(--text-primary);
    }

    .message-detail-message-text {
      white-space: pre-wrap;
      font-family: inherit;
      font-size: 0.9375rem;
      margin: 0.5rem 0 0 0;
      padding: 1rem;
      background: var(--bg-primary);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      max-height: 200px;
      overflow-y: auto;
    }

    .message-detail-meta-wrap {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      font-size: 0.9375rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    .message-detail-meta-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-height: 1.75rem;
    }

    .message-detail-meta-row .meta-icon {
      flex-shrink: 0;
      width: 2rem;
      height: 2rem;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .message-detail-meta-row .meta-icon svg {
      width: 1.125rem;
      height: 1.125rem;
    }

    .message-detail-meta-row .meta-icon--email {
      background: rgba(66, 133, 244, 0.15);
      color: #1a73e8;
    }

    .message-detail-meta-row .meta-icon--instagram {
      background: linear-gradient(135deg, rgba(225, 48, 108, 0.2) 0%, rgba(253, 29, 29, 0.2) 50%, rgba(255, 159, 0, 0.2) 100%);
      color: #e1306c;
    }

    .message-detail-meta-row .meta-icon--phone {
      background: rgba(52, 168, 83, 0.15);
      color: #34a853;
    }

    .message-detail-meta-row .meta-label {
      flex-shrink: 0;
      width: 5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .message-detail-meta-row .meta-value {
      color: var(--text-secondary);
      word-break: break-all;
    }

    .message-detail-meta-wrap a {
      color: var(--accent);
      text-decoration: none;
    }

    .message-detail-meta-wrap a:hover {
      text-decoration: underline;
    }

    .reviews-section .page-header {
      margin-bottom: 1.5rem;
    }

    .review-row {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1rem;
    }

    .review-row-body {
      flex: 1;
      min-width: 0;
    }

    .review-row-meta {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .review-row-influencer {
      font-weight: 600;
      color: var(--text-primary);
    }

    .review-row-content {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }

    .review-row-stars {
      color: #f59e0b;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .review-row-actions {
      flex-shrink: 0;
    }

    .list-section .page-header {
      margin-bottom: 1.5rem;
    }

    .influencers-grid-main {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.25rem;
    }

    .influencer-grid-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      cursor: pointer;
      transition: border-color 0.2s, box-shadow 0.2s, transform 0.2s;
    }

    .influencer-grid-card:hover {
      border-color: var(--accent);
      box-shadow: 0 8px 32px rgba(99, 102, 241, 0.15);
      transform: translateY(-2px);
    }

    .influencer-grid-card-thumb {
      width: 100%;
      aspect-ratio: 16/10;
      object-fit: cover;
      background: var(--bg-secondary);
    }

    .influencer-grid-card-body {
      padding: 1rem;
    }

    .influencer-grid-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .influencer-grid-card-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--bg-secondary);
      flex-shrink: 0;
    }

    .influencer-grid-card-name {
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      font-size: 0.9375rem;
      min-width: 0;
    }

    .influencer-grid-card-username {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.125rem;
    }

    .list-empty {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--text-muted);
      font-size: 0.9375rem;
    }

    /* ========== MOBİL / RESPONSIVE ========== */
    .mobile-header {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      min-height: 56px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 0 1rem;
      align-items: center;
      gap: 0.75rem;
      z-index: 999;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
    }

    .btn-mobile-menu {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      padding: 0;
      border: none;
      background: transparent;
      color: var(--text-primary);
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-mobile-menu:hover,
    .btn-mobile-menu:active {
      background: var(--bg-hover);
    }

    .btn-mobile-menu svg {
      width: 24px;
      height: 24px;
    }

    .mobile-header .logo {
      padding: 0;
      margin: 0;
      border: none;
      flex: 1;
      min-width: 0;
    }

    .mobile-header .logo h1 {
      font-size: 1.125rem;
    }

    .mobile-header-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: auto;
      flex-shrink: 0;
    }
    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      padding: 0;
      border: none;
      border-radius: 10px;
      background: var(--bg-hover);
      color: var(--text-secondary);
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .theme-toggle:hover {
      background: var(--border);
      color: var(--text-primary);
    }
    .theme-toggle-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
    }
    .theme-toggle-icon svg {
      width: 20px;
      height: 20px;
    }
    .theme-toggle .theme-toggle-moon {
      display: none;
    }
    html[data-theme="dark"] .theme-toggle .theme-toggle-sun {
      display: none;
    }
    html[data-theme="dark"] .theme-toggle .theme-toggle-moon {
      display: flex;
    }
    .theme-toggle-sidebar .theme-toggle-moon { display: none !important; }
    html[data-theme="dark"] .theme-toggle-sidebar .theme-toggle-sun { display: none !important; }
    html[data-theme="dark"] .theme-toggle-sidebar .theme-toggle-moon { display: block !important; }
    .theme-toggle-sidebar .nav-item-icon { background: var(--accent-soft); color: var(--accent); }
    .theme-toggle-sidebar:hover .nav-item-icon { background: var(--accent-soft); color: var(--accent-hover); }
    .mobile-header .btn-header-logout--in-header {
      flex-shrink: 0;
      padding: 0.5rem 0.75rem;
      font-size: 0.8125rem;
    }
    .mobile-header .btn-header-logout--in-header .btn-header-logout-text {
      display: none;
    }
    @media (min-width: 420px) {
      .mobile-header .btn-header-logout--in-header .btn-header-logout-text {
        display: inline;
      }
    }

    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.25s ease;
    }

    .sidebar-overlay.visible {
      opacity: 1;
    }

    @media (max-width: 1024px) {
      .app {
        grid-template-columns: 1fr;
      }

      .mobile-header {
        display: flex;
      }

      .main {
        padding-top: calc(56px + 1.5rem);
        padding-left: 1.25rem;
        padding-right: 1.25rem;
        padding-bottom: 2rem;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        max-width: 85vw;
        height: 100vh;
        height: 100dvh;
        z-index: 1001;
        transform: translateX(-100%);
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      .sidebar.open {
        transform: translateX(0);
        box-shadow: 8px 0 24px rgba(0, 0, 0, 0.12);
      }

      body.sidebar-open {
        overflow: hidden;
      }

      .sidebar-overlay {
        display: block;
        pointer-events: none;
      }

      .sidebar-overlay.visible {
        pointer-events: auto;
      }

      .page-header h2 {
        font-size: 1.5rem;
      }

      .hero {
        padding: 2rem 0 3rem;
        max-width: 100%;
      }

      .hero h1 {
        font-size: clamp(1.75rem, 5vw, 2.5rem);
      }

      .hero-stats {
        gap: 2rem;
        margin-top: 2rem;
        padding-top: 2rem;
      }

      .influencers-grid-main {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      }

      .detail-panel-hero {
        min-height: 180px;
      }

      .detail-panel-hero-content {
        flex-wrap: wrap;
      }

      .detail-panel-media {
        flex-wrap: wrap;
      }

      .form-actions .btn {
        min-height: 44px;
      }
    }

    @media (max-width: 640px) {
      .main {
        padding: calc(56px + 1rem) 1rem 1.5rem;
      }

      .page-header {
        margin-bottom: 1.25rem;
      }

      .page-header h2 {
        font-size: 1.375rem;
      }

      .page-header p {
        font-size: 0.875rem;
      }

      .card {
        padding: 1.25rem;
        margin-bottom: 1.25rem;
      }

      .card-title {
        font-size: 1rem;
        margin-bottom: 1rem;
      }

      .hero {
        padding: 1.5rem 0 2.5rem;
      }

      .hero-badge {
        font-size: 0.75rem;
        padding: 0.3rem 0.75rem;
      }

      .hero h1 {
        font-size: clamp(1.5rem, 6vw, 2rem);
      }

      .hero-desc {
        font-size: 1rem;
        margin-bottom: 1.5rem;
      }

      .hero-actions .btn-hero {
        width: 100%;
        justify-content: center;
        min-height: 48px;
      }

      .hero-stats {
        flex-direction: column;
        gap: 1rem;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
      }

      .influencers-grid-main {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .influencer-grid-card-body {
        padding: 0.875rem;
      }

      .form-grid {
        gap: 1rem;
      }

      .form-actions {
        flex-direction: column;
        margin-top: 1.25rem;
      }

      .form-actions .btn {
        width: 100%;
        justify-content: center;
        min-height: 48px;
      }

      .detail-panel-hero-content {
        padding: 1.25rem 1.25rem 1rem;
      }

      .detail-panel-avatar {
        width: 56px;
        height: 56px;
      }

      .detail-panel-name {
        font-size: 1.2rem;
      }

      .detail-panel-media {
        padding: 0.75rem 1.25rem;
        gap: 1rem;
      }

      .detail-panel-media-thumb {
        width: 52px;
        height: 52px;
      }

      .detail-panel-actions {
        flex-direction: column;
        padding: 1rem 1.25rem;
      }

      .detail-panel-actions .btn {
        width: 100%;
        justify-content: center;
        min-height: 48px;
      }

      .toast {
        left: 1rem;
        right: 1rem;
        bottom: 1rem;
        max-width: none;
      }

      .sidebar-btn-add {
        margin-left: 1rem;
        margin-right: 1rem;
        min-height: 44px;
      }

      .nav-item {
        min-height: 48px;
      }

      .sidebar-influencer {
        min-height: 48px;
        padding: 0.625rem 1rem;
      }

      .empty-state,
      .list-empty {
        padding: 2rem 1rem;
        font-size: 0.875rem;
      }
    }

    @media (max-width: 380px) {
      .mobile-header .logo h1 {
        font-size: 1rem;
      }

      .sidebar {
        width: 100%;
        max-width: 100%;
      }
    }

    /* Login ekranı görünürken header gizle */
    .login-screen:not(.hidden) ~ .mobile-header {
      display: none !important;
    }

    /* Admin login screen — tam ekran, elit, modern */
    .login-screen {
      position: fixed;
      inset: 0;
      z-index: 9998;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      width: 100%;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      box-sizing: border-box;
      background-image:
        linear-gradient(160deg, rgba(49, 46, 129, 0.94) 0%, rgba(67, 56, 202, 0.91) 40%, rgba(99, 102, 241, 0.9) 70%, rgba(139, 92, 246, 0.92) 100%),
        url('https://images.unsplash.com/photo-1497366216548-37526070297c?w=1920');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .login-screen.hidden {
      display: none !important;
    }
    .login-screen .login-inner {
      width: 100%;
      max-width: 460px;
      margin: auto;
      padding: 2rem 1.5rem 2.5rem;
      min-height: min(100%, 80vh);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .login-box {
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 24px;
      box-shadow:
        0 32px 64px -12px rgba(0, 0, 0, 0.25),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.06);
      padding: 2.5rem 1.75rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }
    .login-box h1 {
      font-family: 'Outfit', sans-serif;
      font-size: clamp(1.75rem, 5vw, 2.25rem);
      font-weight: 700;
      text-align: center;
      margin-bottom: 0.35rem;
      letter-spacing: -0.03em;
      color: #ffffff;
    }
    .login-box h1 span { color: rgba(255, 255, 255, 0.92); }
    .login-box .login-subtitle {
      text-align: center;
      font-size: 0.9375rem;
      letter-spacing: 0.02em;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 2rem;
    }
    .login-box .form-group {
      margin-bottom: 1.35rem;
    }
    .login-box .form-group label {
      display: block;
      font-size: 0.9375rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      color: rgba(255, 255, 255, 0.98);
      margin-bottom: 0.5rem;
    }
    .login-box .form-group input {
      width: 100%;
      min-height: 52px;
      padding: 0.875rem 1.25rem;
      border: 1px solid rgba(255, 255, 255, 0.28);
      border-radius: 14px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
      box-sizing: border-box;
    }
    .login-box .form-group input::placeholder {
      color: rgba(255, 255, 255, 0.45);
    }
    .login-box .form-group input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1);
    }
    .login-options {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.875rem;
      margin-bottom: 1.25rem;
    }
    .login-remember {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9375rem;
      color: rgba(255, 255, 255, 0.9);
    }
    .login-remember input { width: auto; min-width: 18px; min-height: 18px; }
    .login-link {
      font-size: 0.9375rem;
      color: rgba(255, 255, 255, 0.95);
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .login-link:hover { color: #ffffff; }
    .login-box .btn-login {
      width: 100%;
      min-height: 54px;
      padding: 0.875rem 1.5rem;
      background: rgba(255, 255, 255, 0.96);
      color: #4338ca;
      border: none;
      border-radius: 14px;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, transform 0.15s;
    }
    .login-box .btn-login:hover {
      background: #ffffff;
      color: #3730a3;
    }
    .login-box .btn-login:active { transform: scale(0.99); }
    .login-box .btn-login:disabled { opacity: 0.7; cursor: not-allowed; }
    .login-error {
      font-size: 0.9375rem;
      color: #fecaca;
      margin-top: 0.5rem;
      display: none;
    }
    .login-error.visible { display: block; }
    .login-change-form {
      display: none;
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
    }
    .login-change-form.visible { display: block; }
    @media (max-width: 480px) {
      .login-screen .login-inner {
        padding: 1.5rem 1.25rem 2rem;
      }
      .login-box {
        padding: 2rem 1.5rem;
        border-radius: 20px;
      }
    }

    /* Ana alan üst bar + çıkış onay popup */
    .main-header {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0.75rem 1.5rem;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      min-height: 52px;
    }
    .btn-header-logout {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--danger);
      border-radius: var(--radius);
      cursor: pointer;
      transition: color 0.2s, border-color 0.2s, background 0.2s;
    }
    .btn-header-logout:hover {
      color: #dc2626;
      border-color: #dc2626;
      background: rgba(239, 68, 68, 0.18);
    }
    .btn-header-logout svg { width: 18px; height: 18px; }
    .logout-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    .logout-modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    .logout-modal {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      padding: 1.75rem;
      max-width: 380px;
      width: 100%;
      transform: scale(0.96);
      transition: transform 0.2s ease;
    }
    .logout-modal-overlay.visible .logout-modal {
      transform: scale(1);
    }
    .logout-modal h3 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }
    .logout-modal p {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }
    .logout-modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }
    .logout-modal-actions .btn {
      padding: 0.625rem 1.25rem;
      font-size: 0.9375rem;
      font-weight: 600;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }
    .logout-modal-actions .btn-ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-secondary);
    }
    .logout-modal-actions .btn-ghost:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    .logout-modal-actions .btn-danger {
      background: var(--accent);
      border: none;
      color: white;
    }
    .logout-modal-actions .btn-danger:hover {
      background: var(--accent-hover);
    }

    /* Değerlendirme silme onay modalı — modern, profesyonel */
    .delete-review-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 1100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.25s ease, visibility 0.25s ease;
    }
    .delete-review-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    .delete-review-modal {
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
      max-width: 400px;
      width: 100%;
      padding: 0;
      transform: scale(0.95) translateY(8px);
      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
      overflow: hidden;
    }
    .delete-review-overlay.visible .delete-review-modal {
      transform: scale(1) translateY(0);
    }
    .delete-review-modal-icon {
      width: 56px;
      height: 56px;
      margin: 1.75rem auto 0;
      border-radius: 50%;
      background: rgba(239, 68, 68, 0.12);
      color: #dc2626;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .delete-review-modal-icon svg {
      width: 28px;
      height: 28px;
    }
    .delete-review-modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      text-align: center;
      margin: 1.25rem 1.5rem 0.5rem;
      letter-spacing: -0.02em;
    }
    .delete-review-modal-desc {
      font-size: 0.9375rem;
      color: var(--text-muted);
      text-align: center;
      line-height: 1.55;
      margin: 0 1.5rem 1.75rem;
      padding: 0;
    }
    .delete-review-modal-actions {
      display: flex;
      gap: 0.75rem;
      padding: 0 1.5rem 1.75rem;
      justify-content: center;
    }
    .delete-review-modal-actions .btn {
      min-width: 120px;
      padding: 0.75rem 1.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, border-color 0.2s, transform 0.15s;
    }
    .delete-review-modal-actions .btn:active {
      transform: scale(0.98);
    }
    .delete-review-modal-actions .btn-ghost {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      color: var(--text-secondary);
    }
    .delete-review-modal-actions .btn-ghost:hover {
      background: var(--border);
      color: var(--text-primary);
    }
    .delete-review-modal-actions .btn-danger {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      border: none;
      color: #fff;
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.35);
    }
    .delete-review-modal-actions .btn-danger:hover {
      background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
    }

    /* Admin giriş sonrası splash — prestijli, kurumsal */
    .admin-splash {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .admin-splash.visible {
      opacity: 1;
      visibility: visible;
    }
    .admin-splash.visible .admin-splash-logo-wrap {
      animation: admin-splash-logo-in 1s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    .admin-splash.visible .admin-splash-ring {
      animation: admin-splash-ring 2s ease-out forwards;
    }
    .admin-splash.visible .admin-splash-tagline {
      animation: admin-splash-tagline 0.8s cubic-bezier(0.22, 1, 0.36, 1) 0.4s both;
    }
    .admin-splash-bg {
      position: absolute;
      inset: 0;
      background: #ffffff;
    }
    .admin-splash-ring {
      position: absolute;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: 2px solid rgba(34, 197, 94, 0.25);
      opacity: 0;
      pointer-events: none;
    }
    .admin-splash-logo-wrap {
      position: relative;
      z-index: 2;
      opacity: 0;
      transform: scale(0.85);
    }
    .admin-splash-logo {
      width: min(220px, 55vw);
      height: auto;
      display: block;
      filter: drop-shadow(0 0 40px rgba(34, 197, 94, 0.15));
    }
    .admin-splash-tagline {
      position: relative;
      z-index: 2;
      margin-top: 1.25rem;
      font-size: 0.8125rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(0, 0, 0, 0.45);
      opacity: 0;
    }
    @keyframes admin-splash-logo-in {
      0% {
        opacity: 0;
        transform: scale(0.85);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    @keyframes admin-splash-ring {
      0% {
        opacity: 0;
        transform: scale(0.6);
      }
      30% {
        opacity: 0.6;
        transform: scale(1.1);
      }
      100% {
        opacity: 0;
        transform: scale(1.35);
      }
    }
    @keyframes admin-splash-tagline {
      0% {
        opacity: 0;
        transform: translateY(8px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div id="loginScreen" class="login-screen">
    <div class="login-inner">
    <div class="login-box">
      <h1>Kim<span>Getirdi</span></h1>
      <p class="login-subtitle">Yönetim paneli — admin girişi</p>
      <form id="loginForm">
        <div class="form-group">
          <label for="loginUsername">Kullanıcı adı</label>
          <input type="text" id="loginUsername" name="username" autocomplete="username" placeholder="Admin kullanıcı adı" required />
        </div>
        <div class="form-group">
          <label for="loginPassword">Şifre</label>
          <input type="password" id="loginPassword" name="password" autocomplete="current-password" placeholder="Şifre" required />
        </div>
        <div class="login-options">
          <label class="login-remember">
            <input type="checkbox" id="loginRemember" checked />
            Beni hatırla
          </label>
          <button type="button" class="login-link" id="loginToggleChangePassword">Şifre değiştir</button>
        </div>
        <p id="loginError" class="login-error"></p>
        <button type="submit" class="btn-login" id="loginSubmit">Giriş yap</button>
      </form>
      <div id="loginChangeForm" class="login-change-form">
        <p class="login-subtitle" style="margin-bottom:0.75rem;">Mevcut şifrenizle giriş yapıp yeni şifre belirleyin.</p>
        <form id="changePasswordForm">
          <div class="form-group">
            <label for="changeUsername">Kullanıcı adı</label>
            <input type="text" id="changeUsername" placeholder="Kullanıcı adı" required />
          </div>
          <div class="form-group">
            <label for="changeCurrentPassword">Mevcut şifre</label>
            <input type="password" id="changeCurrentPassword" placeholder="Mevcut şifre" required />
          </div>
          <div class="form-group">
            <label for="changeNewPassword">Yeni şifre</label>
            <input type="password" id="changeNewPassword" placeholder="Yeni şifre" required minlength="6" />
          </div>
          <div class="form-group">
            <label for="changeNewPasswordAgain">Yeni şifre (tekrar)</label>
            <input type="password" id="changeNewPasswordAgain" placeholder="Yeni şifre tekrar" required minlength="6" />
          </div>
          <p id="changePasswordError" class="login-error"></p>
          <button type="submit" class="btn-login" id="changePasswordSubmit">Şifreyi güncelle</button>
        </form>
        <button type="button" class="login-link" style="margin-top:0.75rem;display:block;" id="changePasswordCancel">İptal</button>
      </div>
    </div>
    </div>
  </div>
  <header class="mobile-header" id="mobileHeader" aria-hidden="true">
    <button type="button" class="btn-mobile-menu" id="btnMobileMenu" aria-label="Menüyü aç" aria-expanded="false">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="logo">
      <h1>Kim<span>Getirdi</span></h1>
    </div>
    <div class="mobile-header-actions">
      <button type="button" class="theme-toggle" id="themeToggle" aria-label="Karanlık / aydınlık mod" title="Tema değiştir">
        <span class="theme-toggle-icon theme-toggle-sun" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
        </span>
        <span class="theme-toggle-icon theme-toggle-moon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </span>
      </button>
      <button type="button" class="btn-header-logout btn-header-logout--in-header" id="btnHeaderLogout" aria-label="Çıkış yap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        <span class="btn-header-logout-text">Çıkış yap</span>
      </button>
    </div>
  </header>
  <div class="app" id="appPanel" style="display: none;">
    <div id="adminSplash" class="admin-splash" aria-hidden="true">
      <div class="admin-splash-bg"></div>
      <div class="admin-splash-ring"></div>
      <div class="admin-splash-logo-wrap">
        <img src="public/kimgetirdi-logo.png" alt="Kim Getirdi" class="admin-splash-logo" />
      </div>
      <p class="admin-splash-tagline">Yönetim Paneli</p>
    </div>
    <aside class="sidebar" id="sidebar" aria-label="Ana menü">
      <div class="logo">
        <h1>Kim<span>Getirdi</span></h1>
      </div>
      <button type="button" class="sidebar-btn-add" id="sidebarBtnAdd" aria-label="Yeni influencer ekle">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Yeni Influencer Ekle
      </button>
      <nav>
        <a href="#" class="nav-item nav-item--influencers active" id="navInfluencers">
          <span class="nav-item-icon" aria-hidden>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </span>
          <span class="nav-item-text">Influencer'lar</span>
        </a>
        <a href="#" class="nav-item nav-item--reviews" id="navReviews">
          <span class="nav-item-icon" aria-hidden>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          </span>
          <span class="nav-item-text">Değerlendirmeler</span>
        </a>
        <a href="#" class="nav-item nav-item--reports" id="navReports">
          <span class="nav-item-icon" aria-hidden>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
          </span>
          <span class="nav-item-text">Raporlar</span>
        </a>
        <a href="#" class="nav-item nav-item--messages" id="navMessages">
          <span class="nav-item-icon" aria-hidden>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
          </span>
          <span class="nav-item-text">Mesajlar</span>
        </a>
        <button type="button" class="theme-toggle theme-toggle-sidebar nav-item" id="themeToggleSidebar" aria-label="Karanlık / aydınlık mod" title="Tema değiştir" style="margin-top: auto; border: none; background: transparent; cursor: pointer; width: 100%; text-align: left;">
          <span class="nav-item-icon theme-toggle-icon-wrap" aria-hidden="true">
            <span class="theme-toggle-sun"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px;"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg></span>
            <span class="theme-toggle-moon" style="display:none;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
          </span>
          <span class="nav-item-text">Tema</span>
        </button>
        <button type="button" class="nav-item nav-item--logout" id="btnLogout" style="border: none; background: transparent; cursor: pointer; width: 100%; text-align: left;">
          <span class="nav-item-icon" aria-hidden>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          </span>
          <span class="nav-item-text">Çıkış yap</span>
        </button>
      </nav>
      <p class="sidebar-list-title top">Kayıtlı Influencer'lar</p>
      <div class="sidebar-influencers" id="sidebarInfluencers">
        <div class="sidebar-empty" id="sidebarEmpty">Henüz influencer yok</div>
      </div>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>

    <div id="logoutModalOverlay" class="logout-modal-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="logoutModalTitle">
      <div class="logout-modal" id="logoutModal">
        <h3 id="logoutModalTitle">Çıkış yap</h3>
        <p>Hesabınızdan çıkış yapmak istediğinize emin misiniz?</p>
        <div class="logout-modal-actions">
          <button type="button" class="btn btn-ghost" id="logoutModalCancel">İptal</button>
          <button type="button" class="btn btn-danger" id="logoutModalConfirm">Çıkış yap</button>
        </div>
      </div>
    </div>

    <div id="deleteReviewModalOverlay" class="delete-review-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="deleteReviewModalTitle">
      <div class="delete-review-modal" id="deleteReviewModal">
        <div class="delete-review-modal-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
        </div>
        <h3 id="deleteReviewModalTitle" class="delete-review-modal-title">Değerlendirmeyi sil</h3>
        <p class="delete-review-modal-desc">Bu değerlendirme kalıcı olarak kaldırılacak. Bu işlem geri alınamaz.</p>
        <div class="delete-review-modal-actions">
          <button type="button" class="btn btn-ghost" id="deleteReviewModalCancel">İptal</button>
          <button type="button" class="btn btn-danger" id="deleteReviewModalConfirm">Sil</button>
        </div>
      </div>
    </div>

    <main class="main">
      <div class="main-content">
        <section class="hero visible" id="heroSection">
          <div class="dashboard-wrap">
            <div class="dashboard-header">
              <span class="dashboard-badge">Yönetim Paneli</span>
              <h1 class="dashboard-welcome" id="heroWelcome">Hoşgeldin</h1>
              <p class="dashboard-subtitle">Özet bilgiler ve hızlı işlemler aşağıda.</p>
            </div>
            <div class="dashboard-cards">
              <button type="button" class="dashboard-card dashboard-card--influencers dashboard-card--clickable" id="heroCardInfluencers">
                <div class="dashboard-card-accent" aria-hidden="true"></div>
                <div class="dashboard-card-inner">
                  <div class="dashboard-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                  </div>
                  <div class="dashboard-card-body">
                    <div class="dashboard-card-value" id="heroStatCount">0</div>
                    <div class="dashboard-card-label">Kayıtlı Influencer</div>
                  </div>
                  <span class="dashboard-card-arrow" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></span>
                </div>
              </button>
              <button type="button" class="dashboard-card dashboard-card--reports dashboard-card--clickable" id="heroCardReports">
                <div class="dashboard-card-accent" aria-hidden="true"></div>
                <div class="dashboard-card-inner">
                  <div class="dashboard-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
                  </div>
                  <div class="dashboard-card-body">
                    <div class="dashboard-card-value" id="heroPendingReportsCount">—</div>
                    <div class="dashboard-card-label">Görüntülenmeyen raporlar</div>
                  </div>
                  <span class="dashboard-card-arrow" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></span>
                </div>
              </button>
              <button type="button" class="dashboard-card dashboard-card--reviews dashboard-card--clickable" id="heroCardReviews">
                <div class="dashboard-card-accent" aria-hidden="true"></div>
                <div class="dashboard-card-inner">
                  <div class="dashboard-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                  </div>
                  <div class="dashboard-card-body">
                    <div class="dashboard-card-value" id="heroTotalReviewsCount">—</div>
                    <div class="dashboard-card-label">Toplam değerlendirme</div>
                  </div>
                  <span class="dashboard-card-arrow" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></span>
                </div>
              </button>
              <button type="button" class="dashboard-card dashboard-card--messages dashboard-card--clickable" id="heroCardMessages">
                <div class="dashboard-card-accent" aria-hidden="true"></div>
                <div class="dashboard-card-inner">
                  <div class="dashboard-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                  </div>
                  <div class="dashboard-card-body">
                    <div class="dashboard-card-value" id="heroMessagesCount">—</div>
                    <div class="dashboard-card-label">Görünmeyen mesajlar</div>
                  </div>
                  <span class="dashboard-card-arrow" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></span>
                </div>
              </button>
            </div>
            <div class="dashboard-actions">
              <button type="button" class="btn-hero btn-hero-primary btn-hero--large" id="heroBtnAdd">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Yeni Influencer Ekle
              </button>
            </div>
          </div>
        </section>

        <section class="list-section" id="listSection">
          <header class="page-header">
            <h2>Influencer'lar</h2>
            <p>Kayıtlı influencer'larınız. Detay için bir karta tıklayın.</p>
          </header>
          <div class="influencers-grid-main" id="influencersGridMain">
            <div class="list-empty" id="listEmpty">Henüz influencer yok. Yeni eklemek için sol paneldeki butonu kullanın.</div>
          </div>
        </section>

        <section class="reports-section" id="reportsSection">
          <header class="page-header">
            <h2>Değerlendirme Raporları</h2>
            <p>Kullanıcılar tarafından raporlanan değerlendirmeler. İnceleyip değerlendirmeyi kaldırabilir veya şikayeti gerekçesiz bulabilirsiniz.</p>
          </header>
          <div class="reports-list-wrap" id="reportsListWrap">
            <div class="list-empty" id="reportsEmpty">Bekleyen rapor yok.</div>
          </div>
        </section>

        <section class="messages-section" id="messagesSection">
          <header class="page-header">
            <h2>Mesajlar</h2>
            <p>İletişim formu üzerinden gelen mesajlar. Detay için bir satıra tıklayın.</p>
          </header>
          <div class="messages-list-wrap" id="messagesListWrap">
            <div class="list-empty" id="messagesEmpty">Mesaj yok.</div>
          </div>
        </section>

        <div id="messageDetailModalOverlay" class="message-detail-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="messageDetailModalTitle">
          <div class="message-detail-modal" id="messageDetailModal">
            <div class="message-detail-modal-header">
              <h3 id="messageDetailModalTitle">Mesaj detayı</h3>
              <button type="button" class="message-detail-close" id="messageDetailModalClose" aria-label="Kapat">×</button>
            </div>
            <div class="message-detail-body">
              <p class="message-detail-subject-wrap"><strong>Konu:</strong> <span id="messageDetailSubject"></span></p>
              <p class="message-detail-date-wrap"><strong>Tarih:</strong> <span id="messageDetailDate"></span></p>
              <div class="message-detail-text-wrap"><strong>Mesaj:</strong><pre id="messageDetailMessage" class="message-detail-message-text"></pre></div>
              <div class="message-detail-meta-wrap" id="messageDetailMeta"></div>
            </div>
          </div>
        </div>

        <section class="reviews-section" id="reviewsSection">
          <header class="page-header">
            <h2>Tüm Değerlendirmeler</h2>
            <p>Platformdaki tüm değerlendirmeler. Kalıcı olarak silmek için ilgili satırdaki butonu kullanın.</p>
          </header>
          <div class="reviews-list-wrap" id="reviewsListWrap">
            <div class="list-empty" id="reviewsEmpty">Değerlendirme yok.</div>
          </div>
        </section>

        <section class="form-section" id="formSection">
          <header class="page-header">
            <h2>Yeni Influencer Ekle</h2>
            <p>Profil resmi, thumbnail ve reels linklerini ekleyerek influencer kaydı oluşturun.</p>
          </header>
          <section class="card">
            <h3 class="card-title">Influencer Bilgileri</h3>
            <form id="form-influencer">
          <div class="form-grid">
            <div class="form-group">
              <label for="name">Influencer Adı</label>
              <input type="text" id="name" name="name" placeholder="Örn: Ayşe Yılmaz" required />
            </div>
            <div class="form-group">
              <label for="username">Kullanıcı Adı</label>
              <input type="text" id="username" name="username" placeholder="Örn: ayseyilmaz veya @ayseyilmaz" />
            </div>
            <div class="form-group full">
              <label for="instagramUrl">Instagram Profil Linki</label>
              <input type="url" id="instagramUrl" name="instagramUrl" placeholder="https://www.instagram.com/..." />
            </div>
            <div class="form-group">
              <label for="profileImageUrl">Profil Resmi URL</label>
              <input type="url" id="profileImageUrl" name="profileImageUrl" placeholder="https://..." />
              <p class="form-hint">veya dosya yükle</p>
              <div class="file-upload-wrap">
                <label class="file-upload-btn">
                  <input type="file" id="profileImageFile" accept="image/*" class="file-upload-input" />
                  <span class="file-upload-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                  </span>
                  <span class="file-upload-text">Dosya seç</span>
                </label>
                <span class="form-file-name" id="profileImageFileName"></span>
              </div>
            </div>
            <div class="form-group">
              <label for="thumbnailUrl">Thumbnail URL</label>
              <input type="url" id="thumbnailUrl" name="thumbnailUrl" placeholder="https://..." />
              <p class="form-hint">veya dosya yükle</p>
              <div class="file-upload-wrap">
                <label class="file-upload-btn">
                  <input type="file" id="thumbnailFile" accept="image/*" class="file-upload-input" />
                  <span class="file-upload-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                  </span>
                  <span class="file-upload-text">Dosya seç</span>
                </label>
                <span class="form-file-name" id="thumbnailFileName"></span>
              </div>
            </div>
            <div class="form-group full">
              <label>Reels Linkleri</label>
              <div class="reels-list" id="reelsList">
                <div class="reel-row">
                  <input type="url" name="reel" placeholder="Reels video linki" />
                  <button type="button" class="btn-icon btn-remove-reel" title="Kaldır" aria-label="Kaldır">×</button>
                </div>
              </div>
              <button type="button" class="btn-add-reel" id="addReel">+ Reels linki ekle</button>
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="btnSubmit">
              Influencer Ekle
            </button>
            <button type="button" class="btn btn-ghost" id="btnCancel" style="display: none;">
              İptal
            </button>
          </div>
        </form>
          </section>
        </section>

        <section class="detail-section" id="detailSection">
      <section class="detail-panel card" id="detailPanel">
        <div class="detail-panel-hero">
          <img class="detail-panel-hero-bg" id="detailThumbBg" src="" alt="" referrerpolicy="no-referrer" />
          <div class="detail-panel-hero-overlay"></div>
          <div class="detail-panel-hero-content">
            <img class="detail-panel-avatar" id="detailAvatar" src="" alt="" referrerpolicy="no-referrer" />
            <h2 class="detail-panel-name" id="detailName"></h2>
            <div class="detail-panel-username" id="detailUsername"></div>
          </div>
        </div>
        <div class="detail-panel-media">
          <div class="detail-panel-media-item">
            <span class="detail-panel-media-label">Profil</span>
            <img class="detail-panel-media-thumb" id="detailAvatarSmall" src="" alt="" referrerpolicy="no-referrer" />
          </div>
          <div class="detail-panel-media-item">
            <span class="detail-panel-media-label">Thumbnail</span>
            <img class="detail-panel-media-thumb" id="detailThumb" src="" alt="" referrerpolicy="no-referrer" />
          </div>
          <div class="detail-panel-media-item detail-panel-media-link">
            <span class="detail-panel-media-label">Instagram</span>
            <div class="detail-panel-media-value" id="detailInstagramUrl"></div>
          </div>
        </div>
        <div class="detail-panel-body">
          <div class="detail-field">
            <div class="detail-field-label">Reels</div>
            <ul class="detail-reels-list" id="detailReelsList"></ul>
          </div>
        </div>
        <div class="detail-panel-actions">
          <button type="button" class="btn btn-danger" id="detailBtnDelete">Sil</button>
          <button type="button" class="btn btn-ghost" id="detailBtnEdit">Düzenle</button>
        </div>
      </section>
        </section>
      </div>
    </main>
  </div>

  <div id="toast" class="toast" role="alert" aria-live="polite" style="display: none;"></div>

  <div id="thumbnailCropModal" class="crop-modal" aria-hidden="true">
    <div class="crop-modal-backdrop"></div>
    <div class="crop-modal-box">
      <div class="crop-modal-header">
        <h3 class="crop-modal-title">Thumbnail kırp</h3>
        <p class="crop-modal-desc">Sürükleyerek alanı seçin · Profil sayfasındaki hero oranına uygun (2:1)</p>
      </div>
      <div class="crop-modal-body">
        <div class="crop-view">
          <canvas id="thumbnailCropCanvas"></canvas>
          <div id="thumbnailCropFrame" class="crop-frame"></div>
        </div>
      </div>
      <div class="crop-modal-actions">
        <button type="button" class="btn btn-ghost" id="thumbnailCropCancel">İptal</button>
        <button type="button" class="btn btn-primary" id="thumbnailCropApply">Kırp ve kullan</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      getDoc,
      doc,
      updateDoc,
      deleteDoc,
      serverTimestamp,
      arrayUnion,
    } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
    import {
      getAuth,
      signInWithEmailAndPassword,
      setPersistence,
      onAuthStateChanged,
      signOut,
      updatePassword,
      EmailAuthProvider,
      reauthenticateWithCredential,
      browserLocalPersistence,
      browserSessionPersistence,
    } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

    const firebaseConfig = {
      apiKey: 'AIzaSyCJc3266ApjShpFSkPc-b8rm_cIhHQbFKo',
      authDomain: 'kimgetirdi.firebaseapp.com',
      projectId: 'kimgetirdi',
      storageBucket: 'kimgetirdi.firebasestorage.app',
      messagingSenderId: '817525082261',
      appId: '1:817525082261:web:4662f0a52c36dac8ebb39c',
      measurementId: 'G-HXG6T552VZ',
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const COLLECTION = 'influencers';
    const REPORTS_COLLECTION = 'evaluationReports';
    const CONTACT_MESSAGES_COLLECTION = 'contactMessages';
    const ADMIN_EMAIL_SUFFIX = '@kimgetirdi.local';

    function usernameToEmail(username) {
      const t = (username || '').trim();
      return t.includes('@') ? t : t + ADMIN_EMAIL_SUFFIX;
    }

    const loginScreen = document.getElementById('loginScreen');
    const appPanel = document.getElementById('appPanel');
    const loginForm = document.getElementById('loginForm');
    const loginUsername = document.getElementById('loginUsername');
    const loginPassword = document.getElementById('loginPassword');
    const loginRemember = document.getElementById('loginRemember');
    const loginSubmit = document.getElementById('loginSubmit');
    const loginError = document.getElementById('loginError');
    const loginToggleChangePassword = document.getElementById('loginToggleChangePassword');
    const loginChangeForm = document.getElementById('loginChangeForm');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const changePasswordCancel = document.getElementById('changePasswordCancel');
    const changePasswordError = document.getElementById('changePasswordError');

    const adminSplash = document.getElementById('adminSplash');
    const SPLASH_DURATION_MS = 2600;

    onAuthStateChanged(auth, (user) => {
      if (user) {
        if (loginScreen) loginScreen.classList.add('hidden');
        if (appPanel) appPanel.style.display = 'grid';
        if (sessionStorage.getItem('showAdminSplash') === '1' && adminSplash) {
          sessionStorage.removeItem('showAdminSplash');
          adminSplash.classList.add('visible');
          adminSplash.setAttribute('aria-hidden', 'false');
          setTimeout(() => {
            adminSplash.classList.remove('visible');
            adminSplash.setAttribute('aria-hidden', 'true');
            if (typeof updateHeroDashboard === 'function') updateHeroDashboard();
          }, SPLASH_DURATION_MS);
        } else if (typeof updateHeroDashboard === 'function') {
          updateHeroDashboard();
        }
      } else {
        if (loginScreen) { loginScreen.classList.remove('hidden'); loginScreen.style.display = 'flex'; }
        if (appPanel) appPanel.style.display = 'none';
      }
    });

    if (loginForm) {
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        loginError.classList.remove('visible');
        loginError.textContent = '';
        loginSubmit.disabled = true;
        const email = usernameToEmail(loginUsername.value);
        const password = loginPassword.value;
        try {
          sessionStorage.setItem('showAdminSplash', '1');
          await setPersistence(auth, loginRemember.checked ? browserLocalPersistence : browserSessionPersistence);
          await signInWithEmailAndPassword(auth, email, password);
        } catch (err) {
          sessionStorage.removeItem('showAdminSplash');
          loginError.textContent = err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found'
            ? 'Kullanıcı adı veya şifre hatalı.'
            : (err.message || 'Giriş yapılamadı.');
          loginError.classList.add('visible');
        }
        loginSubmit.disabled = false;
      });
    }

    if (loginToggleChangePassword) {
      loginToggleChangePassword.addEventListener('click', () => {
        loginChangeForm.classList.toggle('visible');
        changePasswordError.classList.remove('visible');
        changePasswordError.textContent = '';
      });
    }
    if (changePasswordCancel) {
      changePasswordCancel.addEventListener('click', () => loginChangeForm.classList.remove('visible'));
    }
    if (changePasswordForm) {
      changePasswordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        changePasswordError.classList.remove('visible');
        changePasswordError.textContent = '';
        const newPass = document.getElementById('changeNewPassword').value;
        const newPassAgain = document.getElementById('changeNewPasswordAgain').value;
        if (newPass !== newPassAgain) {
          changePasswordError.textContent = 'Yeni şifreler eşleşmiyor.';
          changePasswordError.classList.add('visible');
          return;
        }
        if (newPass.length < 6) {
          changePasswordError.textContent = 'Yeni şifre en az 6 karakter olmalı.';
          changePasswordError.classList.add('visible');
          return;
        }
        const btn = document.getElementById('changePasswordSubmit');
        btn.disabled = true;
        try {
          const email = usernameToEmail(document.getElementById('changeUsername').value);
          const currentPassword = document.getElementById('changeCurrentPassword').value;
          const userCred = await signInWithEmailAndPassword(auth, email, currentPassword);
          await updatePassword(userCred.user, newPass);
          showToast('Şifre güncellendi. Yeni şifrenizle giriş yapabilirsiniz.');
          loginChangeForm.classList.remove('visible');
          changePasswordForm.reset();
        } catch (err) {
          changePasswordError.textContent = err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password'
            ? 'Mevcut şifre hatalı.'
            : (err.message || 'Şifre güncellenemedi.');
          changePasswordError.classList.add('visible');
        }
        btn.disabled = false;
      });
    }

    const form = document.getElementById('form-influencer');
    const reelsList = document.getElementById('reelsList');
    const addReelBtn = document.getElementById('addReel');
    const btnSubmit = document.getElementById('btnSubmit');
    const btnCancel = document.getElementById('btnCancel');
    const sidebarInfluencers = document.getElementById('sidebarInfluencers');
    const sidebarEmpty = document.getElementById('sidebarEmpty');
    const toastEl = document.getElementById('toast');
    const heroSection = document.getElementById('heroSection');
    const formSection = document.getElementById('formSection');
    const listSection = document.getElementById('listSection');
    const reportsSection = document.getElementById('reportsSection');
    const messagesSection = document.getElementById('messagesSection');
    const reviewsSection = document.getElementById('reviewsSection');
    const detailSection = document.getElementById('detailSection');
    const heroStatCount = document.getElementById('heroStatCount');
    const heroWelcome = document.getElementById('heroWelcome');
    const heroPendingReportsCount = document.getElementById('heroPendingReportsCount');
    const heroTotalReviewsCount = document.getElementById('heroTotalReviewsCount');
    const heroMessagesCount = document.getElementById('heroMessagesCount');
    const heroCardMessages = document.getElementById('heroCardMessages');
    const heroCardReports = document.getElementById('heroCardReports');
    const heroCardInfluencers = document.getElementById('heroCardInfluencers');
    const heroCardReviews = document.getElementById('heroCardReviews');
    const reportsListWrap = document.getElementById('reportsListWrap');
    const reportsEmpty = document.getElementById('reportsEmpty');
    const messagesListWrap = document.getElementById('messagesListWrap');
    const messagesEmpty = document.getElementById('messagesEmpty');
    const messageDetailOverlay = document.getElementById('messageDetailModalOverlay');
    const messageDetailSubjectEl = document.getElementById('messageDetailSubject');
    const messageDetailDateEl = document.getElementById('messageDetailDate');
    const messageDetailMessageEl = document.getElementById('messageDetailMessage');
    const messageDetailMetaEl = document.getElementById('messageDetailMeta');
    const messageDetailModalClose = document.getElementById('messageDetailModalClose');
    const reviewsListWrap = document.getElementById('reviewsListWrap');
    const reviewsEmpty = document.getElementById('reviewsEmpty');

    let editingId = null;
    let profileImageDataUrl = null;
    let thumbnailDataUrl = null;
    let existingProfileImageUrl = null;
    let existingThumbnailUrl = null;

    function imageFileToBase64(file, maxWidth, quality) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            let w = img.width;
            let h = img.height;
            if (w > maxWidth) {
              h = (h * maxWidth) / w;
              w = maxWidth;
            }
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, w, h);
            const dataUrl = canvas.toDataURL('image/jpeg', quality);
            resolve(dataUrl);
          };
          img.onerror = () => reject(new Error('Görsel yüklenemedi'));
          img.src = e.target.result;
        };
        reader.onerror = () => reject(new Error('Dosya okunamadı'));
        reader.readAsDataURL(file);
      });
    }

    const profileImageFileEl = document.getElementById('profileImageFile');
    const thumbnailFileEl = document.getElementById('thumbnailFile');
    const profileImageFileNameEl = document.getElementById('profileImageFileName');
    const thumbnailFileNameEl = document.getElementById('thumbnailFileName');

    if (profileImageFileEl) {
      profileImageFileEl.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        profileImageDataUrl = null;
        if (profileImageFileNameEl) {
          profileImageFileNameEl.textContent = '';
          profileImageFileNameEl.classList.remove('has-file');
        }
        if (!file || !file.type.startsWith('image/')) return;
        try {
          profileImageDataUrl = await imageFileToBase64(file, 800, 0.82);
          if (profileImageFileNameEl) {
            profileImageFileNameEl.textContent = file.name + ' · base64 ile kaydedilecek';
            profileImageFileNameEl.classList.add('has-file');
          }
        } catch (err) {
          showToast('Profil resmi işlenemedi: ' + (err.message || ''), 'error');
        }
      });
    }
    const THUMBNAIL_CROP_ASPECT = 2;
    const thumbnailCropModal = document.getElementById('thumbnailCropModal');
    const thumbnailCropCanvas = document.getElementById('thumbnailCropCanvas');
    const thumbnailCropFrame = document.getElementById('thumbnailCropFrame');
    const thumbnailCropCancel = document.getElementById('thumbnailCropCancel');
    const thumbnailCropApply = document.getElementById('thumbnailCropApply');
    let thumbnailCropState = null;

    function openThumbnailCrop(file, fileName) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          thumbnailCropState = {
            img,
            fileName,
            displayW: 0,
            displayH: 0,
            frameW: 0,
            frameH: 0,
            frameX: 0,
            frameY: 0,
            dragging: false,
            startX: 0,
            startY: 0,
            startFrameX: 0,
            startFrameY: 0,
          };
          thumbnailCropModal.classList.add('is-open');
          thumbnailCropModal.setAttribute('aria-hidden', 'false');
          initThumbnailCrop();
        };
        img.onerror = () => showToast('Görsel yüklenemedi', 'error');
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function initThumbnailCrop() {
      const s = thumbnailCropState;
      if (!s || !s.img) return;
      const img = s.img;
      const maxViewW = Math.min(560, window.innerWidth - 48);
      const maxViewH = Math.min(320, window.innerHeight - 200);
      let displayW = img.width;
      let displayH = img.height;
      if (displayW > maxViewW || displayH > maxViewH) {
        const r = Math.min(maxViewW / displayW, maxViewH / displayH);
        displayW = Math.round(displayW * r);
        displayH = Math.round(displayH * r);
      }
      s.displayW = displayW;
      s.displayH = displayH;
      let frameW = Math.min(displayW, Math.round(displayH * THUMBNAIL_CROP_ASPECT));
      let frameH = Math.round(frameW / THUMBNAIL_CROP_ASPECT);
      if (frameH > displayH) {
        frameH = displayH;
        frameW = Math.round(frameH * THUMBNAIL_CROP_ASPECT);
      }
      s.frameW = frameW;
      s.frameH = frameH;
      s.frameX = Math.round((displayW - frameW) / 2);
      s.frameY = Math.round((displayH - frameH) / 2);

      thumbnailCropCanvas.width = displayW;
      thumbnailCropCanvas.height = displayH;
      const cropView = thumbnailCropCanvas.closest('.crop-view');
      if (cropView) {
        cropView.style.width = displayW + 'px';
        cropView.style.height = displayH + 'px';
      }
      thumbnailCropFrame.style.width = frameW + 'px';
      thumbnailCropFrame.style.height = frameH + 'px';
      thumbnailCropFrame.style.left = s.frameX + 'px';
      thumbnailCropFrame.style.top = s.frameY + 'px';

      redrawThumbnailCrop();

      thumbnailCropFrame.onmousedown = (e) => {
        if (e.button !== 0) return;
        e.preventDefault();
        s.dragging = true;
        s.startX = e.clientX;
        s.startY = e.clientY;
        s.startFrameX = s.frameX;
        s.startFrameY = s.frameY;
      };
    }

    function redrawThumbnailCrop() {
      const s = thumbnailCropState;
      if (!s || !s.img) return;
      const ctx = thumbnailCropCanvas.getContext('2d');
      ctx.drawImage(s.img, 0, 0, s.displayW, s.displayH);
    }

    document.addEventListener('mousemove', (e) => {
      const s = thumbnailCropState;
      if (!s || !s.dragging) return;
      const dx = e.clientX - s.startX;
      const dy = e.clientY - s.startY;
      s.frameX = Math.max(0, Math.min(s.displayW - s.frameW, s.startFrameX + dx));
      s.frameY = Math.max(0, Math.min(s.displayH - s.frameH, s.startFrameY + dy));
      thumbnailCropFrame.style.left = s.frameX + 'px';
      thumbnailCropFrame.style.top = s.frameY + 'px';
    });

    document.addEventListener('mouseup', () => {
      if (thumbnailCropState) thumbnailCropState.dragging = false;
    });

    function closeThumbnailCropModal() {
      thumbnailCropModal.classList.remove('is-open');
      thumbnailCropModal.setAttribute('aria-hidden', 'true');
      thumbnailCropState = null;
      thumbnailCropFrame.onmousedown = null;
    }

    thumbnailCropCancel.addEventListener('click', () => {
      closeThumbnailCropModal();
      if (thumbnailFileEl) thumbnailFileEl.value = '';
    });

    thumbnailCropModal.querySelector('.crop-modal-backdrop').addEventListener('click', () => {
      closeThumbnailCropModal();
      if (thumbnailFileEl) thumbnailFileEl.value = '';
    });

    thumbnailCropApply.addEventListener('click', () => {
      const s = thumbnailCropState;
      if (!s || !s.img) return;
      const img = s.img;
      const sx = (s.frameX / s.displayW) * img.naturalWidth;
      const sy = (s.frameY / s.displayH) * img.naturalHeight;
      const sw = (s.frameW / s.displayW) * img.naturalWidth;
      const sh = (s.frameH / s.displayH) * img.naturalHeight;
      const outW = 1200;
      const outH = Math.round(outW / THUMBNAIL_CROP_ASPECT);
      const canvas = document.createElement('canvas');
      canvas.width = outW;
      canvas.height = outH;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, sx, sy, sw, sh, 0, 0, outW, outH);
      thumbnailDataUrl = canvas.toDataURL('image/jpeg', 0.85);
      if (thumbnailFileNameEl) {
        thumbnailFileNameEl.textContent = (s.fileName || 'Thumbnail') + ' · kırpıldı, base64';
        thumbnailFileNameEl.classList.add('has-file');
      }
      closeThumbnailCropModal();
      if (thumbnailFileEl) thumbnailFileEl.value = '';
    });

    if (thumbnailFileEl) {
      thumbnailFileEl.addEventListener('change', (e) => {
        const file = e.target.files[0];
        thumbnailDataUrl = null;
        if (thumbnailFileNameEl) {
          thumbnailFileNameEl.textContent = '';
          thumbnailFileNameEl.classList.remove('has-file');
        }
        if (!file || !file.type.startsWith('image/')) return;
        openThumbnailCrop(file, file.name);
      });
    }

    const influencersGridMain = document.getElementById('influencersGridMain');
    const listEmpty = document.getElementById('listEmpty');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const btnMobileMenu = document.getElementById('btnMobileMenu');

    function closeSidebar() {
      if (!sidebar || !sidebar.classList.contains('open')) return;
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('visible');
      document.body.classList.remove('sidebar-open');
      if (btnMobileMenu) {
        btnMobileMenu.setAttribute('aria-expanded', 'false');
        btnMobileMenu.setAttribute('aria-label', 'Menüyü aç');
      }
    }

    function openSidebar() {
      sidebar.classList.add('open');
      sidebarOverlay.classList.add('visible');
      document.body.classList.add('sidebar-open');
      if (btnMobileMenu) {
        btnMobileMenu.setAttribute('aria-expanded', 'true');
        btnMobileMenu.setAttribute('aria-label', 'Menüyü kapat');
      }
    }

    function setNavActive(activeId) {
      document.querySelectorAll('.nav-item').forEach((el) => el.classList.remove('active'));
      const active = document.getElementById(activeId);
      if (active) active.classList.add('active');
    }

    function getDisplayName(user) {
      if (!user) return 'Admin';
      let name = '';
      if (user.displayName && user.displayName.trim()) name = user.displayName.trim();
      else if (user.email) {
        const part = user.email.split('@')[0].trim();
        if (part) name = part;
      }
      if (!name) return 'Admin';
      return name.charAt(0).toUpperCase() + name.slice(1);
    }

    async function updateHeroDashboard() {
      if (heroWelcome && auth.currentUser) {
        heroWelcome.textContent = 'Hoşgeldin, ' + getDisplayName(auth.currentUser);
      }
      try {
        const reportsSnap = await getDocs(collection(db, REPORTS_COLLECTION));
        let pending = 0;
        reportsSnap.docs.forEach((d) => {
          if ((d.data().status || 'pending') === 'pending') pending++;
        });
        if (heroPendingReportsCount) heroPendingReportsCount.textContent = String(pending);
      } catch (_) {
        if (heroPendingReportsCount) heroPendingReportsCount.textContent = '—';
      }
      try {
        const infSnap = await getDocs(collection(db, COLLECTION));
        if (infSnap.empty) {
          window.__dashboardTotalReviews = 0;
          if (heroTotalReviewsCount) heroTotalReviewsCount.textContent = '0';
        } else {
          const reviewSnaps = await Promise.all(
            infSnap.docs.map((d) => getDocs(collection(db, COLLECTION, d.id, 'reviews')))
          );
          const total = reviewSnaps.reduce((s, snap) => s + snap.docs.length, 0);
          window.__dashboardTotalReviews = total;
          if (heroTotalReviewsCount) heroTotalReviewsCount.textContent = String(total);
        }
      } catch (_) {
        if (heroTotalReviewsCount) heroTotalReviewsCount.textContent = '—';
      }
      try {
        const messagesSnap = await getDocs(collection(db, CONTACT_MESSAGES_COLLECTION));
        const uid = auth.currentUser?.uid;
        let unread = 0;
        if (uid) {
          messagesSnap.docs.forEach((d) => {
            const readBy = d.data().readByUids || [];
            if (!readBy.includes(uid)) unread++;
          });
        }
        if (heroMessagesCount) heroMessagesCount.textContent = uid == null ? '—' : String(unread);
      } catch (_) {
        if (heroMessagesCount) heroMessagesCount.textContent = '—';
      }
    }

    async function markMessageAsReadByCurrentUser(messageId) {
      const uid = auth.currentUser?.uid;
      if (!uid || !messageId) return;
      try {
        const ref = doc(db, CONTACT_MESSAGES_COLLECTION, messageId);
        await updateDoc(ref, { readByUids: arrayUnion(uid) });
        updateHeroDashboard();
      } catch (e) {
        console.warn('Okundu işaretlenemedi:', e);
      }
    }

    function showHeroSection() {
      closeSidebar();
      setNavActive('navInfluencers');
      heroSection.classList.add('visible');
      formSection.classList.remove('visible');
      listSection.classList.remove('visible');
      reportsSection.classList.remove('visible');
      messagesSection.classList.remove('visible');
      reviewsSection.classList.remove('visible');
      detailSection.classList.remove('visible');
      hideDetailPanel();
      updateHeroDashboard();
    }

    function showFormSection() {
      closeSidebar();
      setNavActive('navInfluencers');
      heroSection.classList.remove('visible');
      formSection.classList.add('visible');
      listSection.classList.remove('visible');
      reportsSection.classList.remove('visible');
      messagesSection.classList.remove('visible');
      reviewsSection.classList.remove('visible');
      detailSection.classList.remove('visible');
      document.querySelectorAll('.sidebar-influencer').forEach((el) => el.classList.remove('selected'));
      selectedId = null;
    }

    function showListSection() {
      closeSidebar();
      setNavActive('navInfluencers');
      heroSection.classList.remove('visible');
      formSection.classList.remove('visible');
      listSection.classList.add('visible');
      reportsSection.classList.remove('visible');
      messagesSection.classList.remove('visible');
      reviewsSection.classList.remove('visible');
      detailSection.classList.remove('visible');
      loadInfluencersGrid();
    }

    function showReportsSection() {
      closeSidebar();
      setNavActive('navReports');
      heroSection.classList.remove('visible');
      formSection.classList.remove('visible');
      listSection.classList.remove('visible');
      reportsSection.classList.add('visible');
      messagesSection.classList.remove('visible');
      reviewsSection.classList.remove('visible');
      detailSection.classList.remove('visible');
      loadReports();
    }

    function showMessagesSection() {
      closeSidebar();
      setNavActive('navMessages');
      heroSection.classList.remove('visible');
      formSection.classList.remove('visible');
      listSection.classList.remove('visible');
      reportsSection.classList.remove('visible');
      messagesSection.classList.add('visible');
      reviewsSection.classList.remove('visible');
      detailSection.classList.remove('visible');
      loadMessages();
    }

    function showReviewsSection() {
      closeSidebar();
      setNavActive('navReviews');
      heroSection.classList.remove('visible');
      formSection.classList.remove('visible');
      listSection.classList.remove('visible');
      reportsSection.classList.remove('visible');
      messagesSection.classList.remove('visible');
      reviewsSection.classList.add('visible');
      detailSection.classList.remove('visible');
      loadAllReviews();
    }

    function showDetailSection() {
      closeSidebar();
      setNavActive('navInfluencers');
      heroSection.classList.remove('visible');
      formSection.classList.remove('visible');
      listSection.classList.remove('visible');
      reportsSection.classList.remove('visible');
      messagesSection.classList.remove('visible');
      reviewsSection.classList.remove('visible');
      detailSection.classList.add('visible');
    }

    function showToast(message, type = 'success') {
      toastEl.textContent = message;
      toastEl.className = 'toast ' + type;
      toastEl.style.display = 'block';
      setTimeout(() => {
        toastEl.style.display = 'none';
      }, 3500);
    }

    function addReelRow(value = '') {
      const row = document.createElement('div');
      row.className = 'reel-row';
      row.innerHTML = `
        <input type="url" name="reel" placeholder="Reels video linki" value="${value.replace(/"/g, '&quot;')}" />
        <button type="button" class="btn-icon btn-remove-reel" title="Kaldır" aria-label="Kaldır">×</button>
      `;
      row.querySelector('.btn-remove-reel').addEventListener('click', () => {
        if (reelsList.querySelectorAll('.reel-row').length > 1) row.remove();
      });
      reelsList.appendChild(row);
    }

    addReelBtn.addEventListener('click', () => addReelRow());

    reelsList.addEventListener('click', (e) => {
      if (e.target.classList.contains('btn-remove-reel') && reelsList.querySelectorAll('.reel-row').length > 1) {
        e.target.closest('.reel-row').remove();
      }
    });

    function getReelsFromForm() {
      return Array.from(form.querySelectorAll('input[name="reel"]'))
        .map((input) => input.value.trim())
        .filter(Boolean);
    }

    function resetForm() {
      form.reset();
      editingId = null;
      profileImageDataUrl = null;
      thumbnailDataUrl = null;
      if (profileImageFileEl) profileImageFileEl.value = '';
      if (thumbnailFileEl) thumbnailFileEl.value = '';
      if (profileImageFileNameEl) profileImageFileNameEl.textContent = '';
      if (thumbnailFileNameEl) thumbnailFileNameEl.textContent = '';
      reelsList.innerHTML = '';
      addReelRow();
      btnSubmit.textContent = 'Influencer Ekle';
      btnCancel.style.display = 'none';
    }

    btnCancel.addEventListener('click', resetForm);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = form.name.value.trim();
      const username = form.username.value.trim();
      const instagramUrl = form.instagramUrl.value.trim();
      const profileImageUrl = profileImageDataUrl || form.profileImageUrl.value.trim() || (editingId ? existingProfileImageUrl : null) || null;
      const thumbnailUrl = thumbnailDataUrl || form.thumbnailUrl.value.trim() || (editingId ? existingThumbnailUrl : null) || null;
      const reels = getReelsFromForm();

      if (!name) {
        showToast('Lütfen influencer adı girin.', 'error');
        return;
      }

      btnSubmit.disabled = true;
      btnSubmit.innerHTML = '<span class="loading"></span> Kaydediliyor...';

      try {
        if (editingId) {
          const ref = doc(db, COLLECTION, editingId);
          await updateDoc(ref, {
            name,
            username: username || null,
            instagramUrl: instagramUrl || null,
            profileImageUrl: profileImageUrl || null,
            thumbnailUrl: thumbnailUrl || null,
            reels: reels.length ? reels : [],
            updatedAt: serverTimestamp(),
          });
          showToast('Influencer güncellendi.');
        } else {
          await addDoc(collection(db, COLLECTION), {
            name,
            username: username || null,
            instagramUrl: instagramUrl || null,
            profileImageUrl: profileImageUrl || null,
            thumbnailUrl: thumbnailUrl || null,
            reels: reels.length ? reels : [],
            createdAt: serverTimestamp(),
          });
          showToast('Influencer eklendi.');
        }
        resetForm();
        hideDetailPanel();
        loadInfluencers();
      } catch (err) {
        console.error(err);
        showToast('Bir hata oluştu: ' + (err.message || 'Lütfen tekrar deneyin.'), 'error');
      } finally {
        btnSubmit.disabled = false;
        btnSubmit.textContent = editingId ? 'Güncelle' : 'Influencer Ekle';
        btnSubmit.innerHTML = btnSubmit.textContent;
      }
    });

    const placeholderAvatar = 'https://placehold.co/44/e2e8f0/64748b?text=?';
    const placeholderThumb = 'https://placehold.co/400x250/e2e8f0/64748b?text=Thumbnail';

    function proxyImageUrl(url) {
      if (!url || url.startsWith('data:') || url.includes('placehold.co')) return url;
      return 'https://wsrv.nl/?url=' + encodeURIComponent(url) + '&n=-1';
    }
    const detailPanel = document.getElementById('detailPanel');
    const detailThumbBg = document.getElementById('detailThumbBg');
    const detailAvatar = document.getElementById('detailAvatar');
    const detailAvatarSmall = document.getElementById('detailAvatarSmall');
    const detailName = document.getElementById('detailName');
    const detailUsername = document.getElementById('detailUsername');
    const detailThumb = document.getElementById('detailThumb');
    const detailInstagramUrl = document.getElementById('detailInstagramUrl');
    const detailReelsList = document.getElementById('detailReelsList');
    const detailBtnDelete = document.getElementById('detailBtnDelete');
    const detailBtnEdit = document.getElementById('detailBtnEdit');

    let selectedId = null;

    function showDetailPanel(id, data) {
      selectedId = id;
      document.querySelectorAll('.sidebar-influencer').forEach((el) => el.classList.remove('selected'));
      const selectedEl = document.querySelector(`.sidebar-influencer[data-id="${id}"]`);
      if (selectedEl) selectedEl.classList.add('selected');

      const name = data.name || 'İsimsiz';
      const username = data.username || '';
      const instagramUrl = data.instagramUrl || '';
      const reels = data.reels || [];
      const profileImageUrl = data.profileImageUrl || '';
      const thumbnailUrl = data.thumbnailUrl || '';
      const displayUsername = username ? (username.startsWith('@') ? username : '@' + username) : '';

      detailAvatar.referrerPolicy = 'no-referrer';
      detailAvatar.src = profileImageUrl ? proxyImageUrl(profileImageUrl) : placeholderAvatar;
      detailAvatar.onerror = () => { detailAvatar.src = placeholderAvatar; };
      detailName.textContent = name;
      if (displayUsername) {
        detailUsername.innerHTML = instagramUrl
          ? `<a href="${escapeHtml(instagramUrl)}" target="_blank" rel="noopener">${escapeHtml(displayUsername)}</a>`
          : escapeHtml(displayUsername);
      } else {
        detailUsername.innerHTML = instagramUrl ? '<a href="' + escapeHtml(instagramUrl) + '" target="_blank" rel="noopener">Instagram</a>' : '';
      }

      const thumbSrc = thumbnailUrl || profileImageUrl || placeholderThumb;
      const thumbSrcProxied = thumbSrc.includes('placehold') ? thumbSrc : proxyImageUrl(thumbSrc);
      const avatarSrcProxied = profileImageUrl ? proxyImageUrl(profileImageUrl) : placeholderAvatar;

      if (detailThumbBg) {
        detailThumbBg.referrerPolicy = 'no-referrer';
        detailThumbBg.src = thumbSrcProxied;
        detailThumbBg.onerror = () => { detailThumbBg.src = placeholderThumb; };
      }
      detailAvatar.referrerPolicy = 'no-referrer';
      detailAvatar.src = avatarSrcProxied;
      detailAvatar.onerror = () => { detailAvatar.src = placeholderAvatar; };
      if (detailAvatarSmall) {
        detailAvatarSmall.referrerPolicy = 'no-referrer';
        detailAvatarSmall.src = avatarSrcProxied;
        detailAvatarSmall.onerror = () => { detailAvatarSmall.src = placeholderAvatar; };
      }
      detailThumb.referrerPolicy = 'no-referrer';
      detailThumb.src = thumbSrcProxied;
      detailThumb.onerror = () => { detailThumb.src = placeholderThumb; };

      if (instagramUrl) {
        detailInstagramUrl.innerHTML = '<a href="' + escapeHtml(instagramUrl) + '" target="_blank" rel="noopener">' + escapeHtml(instagramUrl) + '</a>';
      } else {
        detailInstagramUrl.textContent = '—';
      }

      detailReelsList.innerHTML = '';
      if (reels && reels.length > 0) {
        reels.forEach((url) => {
          const li = document.createElement('li');
          li.innerHTML = '<a href="' + escapeHtml(url) + '" target="_blank" rel="noopener">' + escapeHtml(url) + '</a>';
          detailReelsList.appendChild(li);
        });
      } else {
        const li = document.createElement('li');
        li.textContent = 'Reels linki yok';
        li.style.color = 'var(--text-muted)';
        detailReelsList.appendChild(li);
      }

      detailBtnDelete.onclick = () => deleteInfluencer(id);
      detailBtnEdit.onclick = () => {
        editInfluencer(id, data);
        showFormSection();
      };
      showDetailSection();
    }

    function hideDetailPanel() {
      selectedId = null;
      document.querySelectorAll('.sidebar-influencer').forEach((el) => el.classList.remove('selected'));
      detailSection.classList.remove('visible');
      heroSection.classList.add('visible');
    }

    function renderSidebarInfluencer(d) {
      const id = d.id;
      const data = d.data();
      const name = data.name || 'İsimsiz';
      const username = data.username || '';
      const profileImageUrl = data.profileImageUrl || '';
      const displayUsername = username ? (username.startsWith('@') ? username : '@' + username) : '';
      const item = document.createElement('div');
      item.className = 'sidebar-influencer';
      item.dataset.id = id;
      item.innerHTML = `
        <img class="sidebar-influencer-avatar" src="${profileImageUrl ? proxyImageUrl(profileImageUrl) : placeholderAvatar}" alt="" loading="lazy" referrerpolicy="no-referrer" onerror="this.src='${placeholderAvatar}'" />
        <div class="sidebar-influencer-text">
          <div class="sidebar-influencer-name">${escapeHtml(name)}</div>
          ${displayUsername ? `<div class="sidebar-influencer-username">${escapeHtml(displayUsername)}</div>` : ''}
        </div>
      `;
      item.addEventListener('click', () => showDetailPanel(id, data));
      return item;
    }

    function renderGridCard(d) {
      const id = d.id;
      const data = d.data();
      const name = data.name || 'İsimsiz';
      const username = data.username || '';
      const profileImageUrl = data.profileImageUrl || '';
      const thumbnailUrl = data.thumbnailUrl || '';
      const displayUsername = username ? (username.startsWith('@') ? username : '@' + username) : '';
      const card = document.createElement('div');
      card.className = 'influencer-grid-card';
      card.innerHTML = `
        <img class="influencer-grid-card-thumb" src="${(thumbnailUrl || profileImageUrl) ? proxyImageUrl(thumbnailUrl || profileImageUrl) : placeholderThumb}" alt="" loading="lazy" referrerpolicy="no-referrer" onerror="this.src='${placeholderThumb}'" />
        <div class="influencer-grid-card-body">
          <div class="influencer-grid-card-header">
            <img class="influencer-grid-card-avatar" src="${profileImageUrl ? proxyImageUrl(profileImageUrl) : placeholderAvatar}" alt="" loading="lazy" referrerpolicy="no-referrer" onerror="this.src='${placeholderAvatar}'" />
            <div class="influencer-grid-card-name">${escapeHtml(name)}</div>
          </div>
          ${displayUsername ? `<div class="influencer-grid-card-username">${escapeHtml(displayUsername)}</div>` : ''}
        </div>
      `;
      card.addEventListener('click', () => showDetailPanel(id, data));
      return card;
    }

    async function loadInfluencersGrid() {
      const existing = influencersGridMain.querySelectorAll('.influencer-grid-card');
      existing.forEach((el) => el.remove());
      listEmpty.style.display = 'none';
      try {
        const snapshot = await getDocs(collection(db, COLLECTION));
        if (snapshot.empty) {
          listEmpty.style.display = 'block';
          return;
        }
        snapshot.docs.forEach((d) => influencersGridMain.appendChild(renderGridCard(d)));
      } catch (err) {
        listEmpty.style.display = 'block';
        listEmpty.textContent = 'Liste yüklenirken hata oluştu.';
      }
    }

    async function loadReports() {
      if (!reportsListWrap || !reportsEmpty) return;
      reportsListWrap.querySelectorAll('.report-card').forEach((el) => el.remove());
      reportsEmpty.style.display = 'none';
      try {
        const snapshot = await getDocs(collection(db, REPORTS_COLLECTION));
        const docs = snapshot.docs.slice().sort((a, b) => {
          const tA = a.data().createdAt?.toMillis?.() ?? 0;
          const tB = b.data().createdAt?.toMillis?.() ?? 0;
          return tB - tA;
        });
        if (docs.length === 0) {
          reportsEmpty.style.display = 'block';
          reportsEmpty.textContent = 'Bekleyen rapor yok.';
          return;
        }
        const infCache = {};
        for (const d of docs) {
          const data = d.data();
          const id = d.id;
          const influencerId = data.influencerId || '';
          const reviewId = data.reviewId || '';
          const reason = data.reason || '';
          const description = data.description || '';
          const reviewSummary = data.reviewSummary || '(Özet yok)';
          const status = data.status || 'pending';
          const createdAt = data.createdAt;
          const date = createdAt?.toDate?.()?.toLocaleDateString?.('tr-TR') || '—';
          const resolvedAt = data.resolvedAt?.toDate?.()?.toLocaleDateString?.('tr-TR');
          let infName = infCache[influencerId];
          if (infName === undefined) {
            try {
              const infSnap = await getDoc(doc(db, COLLECTION, influencerId));
              infName = infSnap.exists() ? (infSnap.data().name || 'İsimsiz') : 'Bilinmeyen';
            } catch (_) {
              infName = 'Bilinmeyen';
            }
            infCache[influencerId] = infName;
          }
          const card = document.createElement('div');
          card.className = 'report-card' + (status !== 'pending' ? ' resolved' : '');
          const statusLabel = status === 'resolved_removed' ? 'İnceleme sonucu: Değerlendirme kaldırıldı' : status === 'resolved_upheld' ? 'İnceleme sonucu: Şikayet gerekçesiz bulundu' : '';
          card.innerHTML = `
            <div class="report-card-header">
              <span class="report-card-influencer">${escapeHtml(infName)}</span>
              <span class="report-card-date">${escapeHtml(date)}</span>
              ${resolvedAt ? '<span class="report-card-date">· Sonuç: ' + escapeHtml(resolvedAt) + '</span>' : ''}
            </div>
            <div class="report-card-summary">${escapeHtml(reviewSummary)}</div>
            <div class="report-card-reason">${escapeHtml(reason)}</div>
            <div class="report-card-description">${escapeHtml(description) || '—'}</div>
            ${status === 'pending' ? `
            <div class="report-card-actions">
              <button type="button" class="btn btn-danger" data-action="remove" data-report-id="${escapeHtml(id)}" data-influencer-id="${escapeHtml(influencerId)}" data-review-id="${escapeHtml(reviewId)}">İnceleme sonucu: Değerlendirmeyi kaldır</button>
              <button type="button" class="btn btn-ghost" data-action="upheld" data-report-id="${escapeHtml(id)}">İnceleme sonucu: Şikayet gerekçesiz</button>
            </div>
            ` : '<div class="report-card-description" style="margin-bottom:0;color:var(--text-muted);">' + escapeHtml(statusLabel) + '</div>'}
          `;
          if (status === 'pending') {
            const btnRemove = card.querySelector('[data-action="remove"]');
            const btnUpheld = card.querySelector('[data-action="upheld"]');
            if (btnRemove) {
              btnRemove.addEventListener('click', async () => {
                if (!confirm('Bu değerlendirmeyi kalıcı olarak kaldırmak istediğinize emin misiniz?')) return;
                const rid = btnRemove.dataset.reportId;
                const iid = btnRemove.dataset.influencerId;
                const revid = btnRemove.dataset.reviewId;
                try {
                  try {
                    await deleteDoc(doc(db, COLLECTION, iid, 'reviews', revid));
                  } catch (_) {
                    // Değerlendirme zaten silinmiş olabilir
                  }
                  await updateDoc(doc(db, REPORTS_COLLECTION, rid), { status: 'resolved_removed', resolvedAt: serverTimestamp() });
                  showToast('Değerlendirme kaldırıldı.');
                  loadReports();
                } catch (err) {
                  showToast('İşlem başarısız: ' + (err.message || 'Tekrar deneyin.'), 'error');
                }
              });
            }
            if (btnUpheld) {
              btnUpheld.addEventListener('click', async () => {
                const rid = btnUpheld.dataset.reportId;
                try {
                  await updateDoc(doc(db, REPORTS_COLLECTION, rid), { status: 'resolved_upheld', resolvedAt: serverTimestamp() });
                  showToast('Rapor şikayet gerekçesiz olarak işaretlendi.');
                  loadReports();
                } catch (err) {
                  showToast('İşlem başarısız: ' + (err.message || 'Tekrar deneyin.'), 'error');
                }
              });
            }
          }
          reportsListWrap.appendChild(card);
        }
      } catch (err) {
        console.error(err);
        reportsEmpty.style.display = 'block';
        reportsEmpty.textContent = 'Raporlar yüklenirken hata oluştu.';
      }
    }

    function instagramToUrl(val) {
      const u = (val || '').trim().replace(/^@/, '');
      return u ? 'https://www.instagram.com/' + encodeURIComponent(u) + '/' : '';
    }

    function phoneToTelUrl(phone) {
      const digits = (phone || '').replace(/\D/g, '');
      if (!digits.length) return '';
      return 'tel:' + (digits.startsWith('90') ? '+' : digits.length <= 10 ? '+90' : '') + digits;
    }

    var iconEmail = '<span class="meta-icon meta-icon--email" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></span>';
    var iconInstagram = '<span class="meta-icon meta-icon--instagram" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg></span>';
    var iconPhone = '<span class="meta-icon meta-icon--phone" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg></span>';

    function openMessageDetail(data) {
      if (!messageDetailOverlay || !messageDetailSubjectEl || !messageDetailDateEl || !messageDetailMessageEl || !messageDetailMetaEl) return;
      if (data.id) markMessageAsReadByCurrentUser(data.id);
      messageDetailSubjectEl.textContent = data.subject || '(Konu yok)';
      messageDetailDateEl.textContent = data.date || '—';
      messageDetailMessageEl.textContent = data.message || '—';
      const rows = [];
      if (data.email) {
        const gmailUrl = 'https://mail.google.com/mail/?view=cm&fs=1&to=' + encodeURIComponent(data.email);
        rows.push('<div class="message-detail-meta-row">' + iconEmail + '<span class="meta-label">E-posta</span><span class="meta-value"><a href="' + escapeHtml(gmailUrl) + '" target="_blank" rel="noopener noreferrer">' + escapeHtml(data.email) + '</a></span></div>');
      }
      if (data.instagram) {
        const igUrl = instagramToUrl(data.instagram);
        rows.push(igUrl ? '<div class="message-detail-meta-row">' + iconInstagram + '<span class="meta-label">Instagram</span><span class="meta-value"><a href="' + escapeHtml(igUrl) + '" target="_blank" rel="noopener noreferrer">' + escapeHtml(data.instagram.trim()) + '</a></span></div>' : '<div class="message-detail-meta-row">' + iconInstagram + '<span class="meta-label">Instagram</span><span class="meta-value">' + escapeHtml(data.instagram) + '</span></div>');
      }
      if (data.phone) {
        const telUrl = phoneToTelUrl(data.phone);
        rows.push(telUrl ? '<div class="message-detail-meta-row">' + iconPhone + '<span class="meta-label">Telefon</span><span class="meta-value"><a href="' + escapeHtml(telUrl) + '">' + escapeHtml(data.phone) + '</a></span></div>' : '<div class="message-detail-meta-row">' + iconPhone + '<span class="meta-label">Telefon</span><span class="meta-value">' + escapeHtml(data.phone) + '</span></div>');
      }
      messageDetailMetaEl.innerHTML = rows.length ? rows.join('') : '<div class="message-detail-meta-row"><span class="meta-value">—</span></div>';
      messageDetailOverlay.classList.add('visible');
      messageDetailOverlay.setAttribute('aria-hidden', 'false');
    }

    function closeMessageDetail() {
      if (messageDetailOverlay) {
        messageDetailOverlay.classList.remove('visible');
        messageDetailOverlay.setAttribute('aria-hidden', 'true');
      }
    }

    async function loadMessages() {
      if (!messagesListWrap || !messagesEmpty) return;
      messagesListWrap.querySelectorAll('.message-row').forEach((el) => el.remove());
      messagesEmpty.style.display = 'none';
      try {
        const snapshot = await getDocs(collection(db, CONTACT_MESSAGES_COLLECTION));
        const docs = snapshot.docs.slice().sort((a, b) => {
          const tA = a.data().createdAt?.toMillis?.() ?? 0;
          const tB = b.data().createdAt?.toMillis?.() ?? 0;
          return tB - tA;
        });
        if (docs.length === 0) {
          messagesEmpty.style.display = 'block';
          messagesEmpty.textContent = 'Henüz mesaj yok.';
          return;
        }
        docs.forEach((d) => {
          const data = d.data();
          const subject = data.subject || '(Konu yok)';
          const email = data.email || '—';
          const createdAt = data.createdAt;
          const date = createdAt?.toDate?.()?.toLocaleDateString?.('tr-TR') || '—';
          const row = document.createElement('div');
          row.className = 'message-row';
          row.setAttribute('role', 'button');
          row.setAttribute('tabindex', '0');
          row.innerHTML = `
            <div>
              <span class="message-row-sender">${escapeHtml(email)}</span>
              <span class="message-row-subject"> · ${escapeHtml(subject)}</span>
            </div>
            <span class="message-row-arrow" aria-hidden="true">→</span>
          `;
          row.addEventListener('click', () => openMessageDetail({
            id: d.id,
            subject,
            message: data.message || '',
            email: data.email || '',
            instagram: data.instagram || '',
            phone: data.phone || '',
            date,
          }));
          row.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); row.click(); } });
          messagesListWrap.appendChild(row);
        });
      } catch (err) {
        console.error(err);
        messagesEmpty.style.display = 'block';
        messagesEmpty.textContent = 'Mesajlar yüklenirken hata oluştu.';
      }
    }

    async function loadAllReviews() {
      if (!reviewsListWrap || !reviewsEmpty) return;
      reviewsListWrap.querySelectorAll('.review-row').forEach((el) => el.remove());
      reviewsEmpty.style.display = 'none';
      reviewsEmpty.textContent = 'Değerlendirmeler yükleniyor…';
      reviewsEmpty.style.display = 'block';
      try {
        const infSnapshot = await getDocs(collection(db, COLLECTION));
        const infDocs = infSnapshot.docs;
        if (infDocs.length === 0) {
          reviewsEmpty.textContent = 'Henüz değerlendirme yok.';
          return;
        }
        const reviewSnaps = await Promise.all(
          infDocs.map((infDoc) => getDocs(collection(db, COLLECTION, infDoc.id, 'reviews')))
        );
        const items = [];
        infDocs.forEach((infDoc, idx) => {
          const infId = infDoc.id;
          const infName = infDoc.data().name || 'İsimsiz';
          const reviewsSnap = reviewSnaps[idx];
          reviewsSnap.docs.forEach((revDoc) => {
            const d = revDoc.data();
            const createdAt = d.createdAt?.toMillis?.() ?? 0;
            const date = d.createdAt?.toDate?.()?.toLocaleDateString?.('tr-TR') || '—';
            items.push({
              influencerId: infId,
              influencerName: infName,
              reviewId: revDoc.id,
              businessName: d.businessName || '—',
              stars: typeof d.stars === 'number' ? d.stars : 0,
              comment: d.comment || '',
              date,
              createdAt,
            });
          });
        });
        items.sort((a, b) => b.createdAt - a.createdAt);
        reviewsEmpty.style.display = 'none';
        if (items.length === 0) {
          window.__dashboardTotalReviews = 0;
          if (heroTotalReviewsCount) heroTotalReviewsCount.textContent = '0';
          reviewsEmpty.style.display = 'block';
          reviewsEmpty.textContent = 'Henüz değerlendirme yok.';
          return;
        }
        for (const item of items) {
          const row = document.createElement('div');
          row.className = 'review-row';
          const starsStr = '★'.repeat(Math.min(5, Math.max(0, item.stars))) + '☆'.repeat(5 - Math.min(5, Math.max(0, item.stars)));
          row.innerHTML = `
            <div class="review-row-body">
              <div class="review-row-meta">
                <span class="review-row-influencer">${escapeHtml(item.influencerName)}</span> · ${escapeHtml(item.date)}
              </div>
              <div class="review-row-content"><strong>${escapeHtml(item.businessName)}</strong></div>
              <div class="review-row-stars" aria-label="${item.stars} yıldız">${starsStr}</div>
              ${item.comment ? '<div class="review-row-content" style="margin-top:0.5rem;">' + escapeHtml(item.comment) + '</div>' : ''}
            </div>
            <div class="review-row-actions">
              <button type="button" class="btn btn-danger" data-inf-id="${escapeHtml(item.influencerId)}" data-review-id="${escapeHtml(item.reviewId)}">Kalıcı olarak sil</button>
            </div>
          `;
          const btn = row.querySelector('.btn-danger');
          if (btn) {
            btn.addEventListener('click', () => {
              const infId = btn.dataset.infId;
              const reviewId = btn.dataset.reviewId;
              openDeleteReviewModal(infId, reviewId, row);
            });
          }
          reviewsListWrap.appendChild(row);
        }
        window.__dashboardTotalReviews = items.length;
        if (heroTotalReviewsCount) heroTotalReviewsCount.textContent = String(items.length);
      } catch (err) {
        console.error(err);
        reviewsEmpty.style.display = 'block';
        reviewsEmpty.textContent = 'Değerlendirmeler yüklenirken hata oluştu.';
      }
    }

    document.getElementById('sidebarBtnAdd').addEventListener('click', showFormSection);
    document.getElementById('heroBtnAdd').addEventListener('click', showFormSection);
    if (heroCardReports) heroCardReports.addEventListener('click', showReportsSection);
    if (heroCardInfluencers) heroCardInfluencers.addEventListener('click', showListSection);
    if (heroCardReviews) heroCardReviews.addEventListener('click', showReviewsSection);
    if (heroCardMessages) heroCardMessages.addEventListener('click', showMessagesSection);
    document.getElementById('navInfluencers').addEventListener('click', (e) => {
      e.preventDefault();
      showListSection();
    });
    document.getElementById('navReviews').addEventListener('click', (e) => {
      e.preventDefault();
      showReviewsSection();
    });
    document.getElementById('navReports').addEventListener('click', (e) => {
      e.preventDefault();
      showReportsSection();
    });
    document.getElementById('navMessages').addEventListener('click', (e) => {
      e.preventDefault();
      showMessagesSection();
    });
    const logoutModalOverlay = document.getElementById('logoutModalOverlay');
    const logoutModalCancel = document.getElementById('logoutModalCancel');
    const logoutModalConfirm = document.getElementById('logoutModalConfirm');

    const deleteReviewModalOverlay = document.getElementById('deleteReviewModalOverlay');
    const deleteReviewModalCancel = document.getElementById('deleteReviewModalCancel');
    const deleteReviewModalConfirm = document.getElementById('deleteReviewModalConfirm');
    let deleteReviewPending = null;

    function openDeleteReviewModal(infId, reviewId, row) {
      deleteReviewPending = { infId, reviewId, row };
      if (deleteReviewModalOverlay) {
        deleteReviewModalOverlay.classList.add('visible');
        deleteReviewModalOverlay.setAttribute('aria-hidden', 'false');
      }
    }

    function closeDeleteReviewModal() {
      deleteReviewPending = null;
      if (deleteReviewModalOverlay) {
        deleteReviewModalOverlay.classList.remove('visible');
        deleteReviewModalOverlay.setAttribute('aria-hidden', 'true');
      }
    }

    async function confirmDeleteReviewModal() {
      if (!deleteReviewPending) return;
      const { infId, reviewId, row } = deleteReviewPending;
      const btn = row ? row.querySelector('.btn-danger') : null;
      if (btn) {
        btn.disabled = true;
        btn.textContent = 'Siliniyor…';
      }
      closeDeleteReviewModal();
      try {
        await deleteDoc(doc(db, COLLECTION, infId, 'reviews', reviewId));
        showToast('Değerlendirme silindi.');
        if (row) row.remove();
        if (reviewsListWrap && reviewsEmpty) {
          if (reviewsListWrap.querySelectorAll('.review-row').length === 0) {
            reviewsEmpty.style.display = 'block';
            reviewsEmpty.textContent = 'Henüz değerlendirme yok.';
          }
        }
        if (heroTotalReviewsCount && window.__dashboardTotalReviews != null) {
          window.__dashboardTotalReviews = Math.max(0, (window.__dashboardTotalReviews || 0) - 1);
          heroTotalReviewsCount.textContent = String(window.__dashboardTotalReviews);
        }
      } catch (err) {
        showToast('Silinirken hata: ' + (err.message || 'Tekrar deneyin.'), 'error');
        if (btn) {
          btn.disabled = false;
          btn.textContent = 'Kalıcı olarak sil';
        }
      }
      deleteReviewPending = null;
    }

    function openLogoutModal() {
      if (logoutModalOverlay) {
        logoutModalOverlay.classList.add('visible');
        logoutModalOverlay.setAttribute('aria-hidden', 'false');
      }
    }
    function closeLogoutModal() {
      if (logoutModalOverlay) {
        logoutModalOverlay.classList.remove('visible');
        logoutModalOverlay.setAttribute('aria-hidden', 'true');
      }
    }
    function doLogout() {
      closeLogoutModal();
      signOut(auth).then(() => showToast('Çıkış yapıldı.'));
    }

    document.getElementById('btnLogout').addEventListener('click', openLogoutModal);
    document.getElementById('btnHeaderLogout').addEventListener('click', openLogoutModal);
    if (logoutModalCancel) logoutModalCancel.addEventListener('click', closeLogoutModal);
    if (logoutModalConfirm) logoutModalConfirm.addEventListener('click', doLogout);
    if (logoutModalOverlay) {
      logoutModalOverlay.addEventListener('click', (e) => { if (e.target === logoutModalOverlay) closeLogoutModal(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && logoutModalOverlay.classList.contains('visible')) closeLogoutModal(); });
    }

    if (deleteReviewModalCancel) deleteReviewModalCancel.addEventListener('click', closeDeleteReviewModal);
    if (deleteReviewModalConfirm) deleteReviewModalConfirm.addEventListener('click', confirmDeleteReviewModal);
    if (deleteReviewModalOverlay) {
      deleteReviewModalOverlay.addEventListener('click', (e) => { if (e.target === deleteReviewModalOverlay) closeDeleteReviewModal(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && deleteReviewModalOverlay.classList.contains('visible')) closeDeleteReviewModal(); });
    }

    if (messageDetailModalClose) messageDetailModalClose.addEventListener('click', closeMessageDetail);
    if (messageDetailOverlay) {
      messageDetailOverlay.addEventListener('click', (e) => { if (e.target === messageDetailOverlay) closeMessageDetail(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && messageDetailOverlay.classList.contains('visible')) closeMessageDetail(); });
    }

    (function initTheme() {
      var saved = localStorage.getItem('theme');
      var theme = (saved === 'dark' || saved === 'light') ? saved : 'light';
      document.documentElement.setAttribute('data-theme', theme);
      function toggleTheme() {
        var current = document.documentElement.getAttribute('data-theme');
        var next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      }
      var themeToggle = document.getElementById('themeToggle');
      var themeToggleSidebar = document.getElementById('themeToggleSidebar');
      if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
      if (themeToggleSidebar) themeToggleSidebar.addEventListener('click', toggleTheme);
    })();

    document.querySelectorAll('.logo').forEach((el) => {
      el.addEventListener('click', (e) => {
        e.preventDefault();
        showHeroSection();
      });
    });

    if (btnMobileMenu && sidebar && sidebarOverlay) {
      btnMobileMenu.addEventListener('click', () => {
        const isOpen = sidebar.classList.contains('open');
        if (isOpen) closeSidebar();
        else openSidebar();
      });
      sidebarOverlay.addEventListener('click', closeSidebar);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function editInfluencer(id, data) {
      editingId = id;
      profileImageDataUrl = null;
      thumbnailDataUrl = null;
      existingProfileImageUrl = data.profileImageUrl || null;
      existingThumbnailUrl = data.thumbnailUrl || null;
      if (profileImageFileEl) profileImageFileEl.value = '';
      if (thumbnailFileEl) thumbnailFileEl.value = '';
      if (profileImageFileNameEl) profileImageFileNameEl.textContent = '';
      if (thumbnailFileNameEl) thumbnailFileNameEl.textContent = '';
      form.name.value = data.name || '';
      form.username.value = data.username || '';
      form.instagramUrl.value = data.instagramUrl || '';
      form.profileImageUrl.value = (data.profileImageUrl && !data.profileImageUrl.startsWith('data:')) ? data.profileImageUrl : '';
      form.thumbnailUrl.value = (data.thumbnailUrl && !data.thumbnailUrl.startsWith('data:')) ? data.thumbnailUrl : '';
      reelsList.innerHTML = '';
      (data.reels && data.reels.length ? data.reels : ['']).forEach((url) => addReelRow(url));
      btnSubmit.textContent = 'Güncelle';
      btnCancel.style.display = 'inline-flex';
      form.scrollIntoView({ behavior: 'smooth' });
    }

    async function deleteInfluencer(id) {
      if (!confirm('Bu influencer\'ı silmek istediğinize emin misiniz?')) return;
      try {
        await deleteDoc(doc(db, COLLECTION, id));
        showToast('Influencer silindi.');
        hideDetailPanel();
        loadInfluencers();
      } catch (err) {
        showToast('Silinirken hata: ' + (err.message || 'Tekrar deneyin.'), 'error');
      }
    }

    async function loadInfluencers() {
      const existing = sidebarInfluencers.querySelectorAll('.sidebar-influencer');
      existing.forEach((el) => el.remove());
      sidebarEmpty.style.display = 'none';

      try {
        const snapshot = await getDocs(collection(db, COLLECTION));
        if (snapshot.empty) {
          sidebarEmpty.style.display = 'block';
          sidebarEmpty.textContent = 'Henüz influencer yok';
          if (heroStatCount) heroStatCount.textContent = '0';
          return;
        }
        if (heroStatCount) heroStatCount.textContent = snapshot.docs.length;
        snapshot.docs.forEach((d) => sidebarInfluencers.appendChild(renderSidebarInfluencer(d)));
        if (listSection.classList.contains('visible')) loadInfluencersGrid();
      } catch (err) {
        console.error(err);
        showToast('Liste yüklenirken hata oluştu.', 'error');
        sidebarEmpty.style.display = 'block';
        sidebarEmpty.textContent = 'Veriler yüklenemedi.';
      }
    }

    loadInfluencers();
  </script>
</body>
</html>
